<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Healthy Meal Engine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <meta name="description" content="Turn your grocery budget into a simple, healthy, realistic plan." />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg: #e6f6ea;
      --card-bg: #ffffff;
      --accent: #25c46a;
      --accent-soft: #def7e7;
      --accent-strong: #13a557;
      --text-main: #172b37;
      --text-soft: #4b6475;
      --border-soft: #dde7e9;
      --chip-bg: #f4fbf6;
      --chip-border: #d5ece0;
      --danger-bg: #ffe5e5;
      --danger-text: #b04040;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top left, #f1fff6 0, var(--bg) 55%, #ddf1e6 100%);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    .page {
      max-width: 960px;
      margin: 32px auto 48px;
      padding: 0 16px 40px;
    }

    .shell {
      background: var(--card-bg);
      border-radius: 28px;
      box-shadow: 0 20px 45px rgba(31, 65, 45, 0.12);
      padding: 24px 18px 32px;
    }

    @media (min-width: 768px) {
      .shell {
        padding: 28px 28px 36px;
      }
    }

    /* HERO */

    .hero {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr);
      gap: 20px;
    }

    @media (min-width: 880px) {
      .hero {
        grid-template-columns: minmax(0, 1.6fr) minmax(0, 1.1fr);
        align-items: stretch;
      }
    }

    .hero-main {
      background: linear-gradient(135deg, #f1fff8 0%, #ffffff 40%, #f3fff6 100%);
      border-radius: 28px;
      padding: 20px 18px 18px;
      border: 1px solid #e2f1e7;
    }

    .hero-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .logo-pill {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: radial-gradient(circle at 20% 10%, #c7ffb6 0, #25c46a 45%, #0f8a49 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ffffff;
      font-weight: 700;
      font-size: 20px;
      box-shadow: 0 0 0 6px rgba(12, 188, 95, 0.08);
      flex-shrink: 0;
    }

    .hero-title-block h1 {
      margin: 0 0 4px;
      font-size: 22px;
      letter-spacing: -0.01em;
    }

    .hero-title-block p {
      margin: 0;
      font-size: 13px;
      color: var(--text-soft);
    }

    .focus-chips {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 14px;
      margin-bottom: 14px;
    }

    .focus-chip {
      border-radius: 999px;
      padding: 6px 12px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #f6fbf7;
      border: 1px solid #e2f1e7;
      font-size: 12px;
    }

    .focus-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
    }

    .focus-dot--primary {
      background: #24c769;
      box-shadow: 0 0 0 3px rgba(36, 199, 105, 0.2);
    }

    .focus-dot--secondary {
      background: #5b70ff;
      box-shadow: 0 0 0 3px rgba(91, 112, 255, 0.2);
    }

    .focus-chip strong {
      font-weight: 600;
      margin-right: 4px;
    }

    .hero-promise {
      border-radius: 18px;
      padding: 12px 12px 10px;
      background: linear-gradient(135deg, #e9fcee 0%, #f5fff7 100%);
      border: 1px solid #d9f2df;
      margin-bottom: 12px;
      font-size: 13px;
      color: #285343;
    }

    .hero-promise-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .hero-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 11px;
      background-color: #ffffff;
      border: 1px solid #d9f2df;
      color: #285343;
    }

    .hero-badge-emoji {
      font-size: 14px;
    }

    .hero-images {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      grid-template-rows: auto auto;
      gap: 6px;
      margin-top: 10px;
    }

    .hero-img-main {
      grid-column: 1 / span 2;
      border-radius: 16px;
      overflow: hidden;
      height: 148px;
    }

    .hero-img-main img,
    .hero-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .hero-img {
      border-radius: 14px;
      overflow: hidden;
      height: 70px;
    }

    /* FORM PANEL */

    .form-card {
      background: #ffffff;
      border-radius: 24px;
      border: 1px solid var(--border-soft);
      padding: 18px 14px 18px;
    }

    @media (min-width: 880px) {
      .form-card {
        padding: 20px 16px 20px;
      }
    }

    .form-card h2 {
      font-size: 18px;
      margin: 0 0 6px;
    }

    .form-card p {
      margin: 0 0 14px;
      font-size: 13px;
      color: var(--text-soft);
    }

    .field-label {
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      color: #496472;
      margin-bottom: 4px;
    }

    .field-label span {
      font-weight: 500;
      text-transform: none;
      letter-spacing: normal;
      color: var(--text-soft);
    }

    .field {
      margin-bottom: 14px;
    }

    .toggle-pill {
      display: inline-flex;
      align-items: center;
      padding: 3px;
      border-radius: 999px;
      background: #f4f6fb;
      border: 1px solid #d5dde8;
      margin-bottom: 6px;
    }

    .toggle-pill button {
      border-radius: 999px;
      border: none;
      background: transparent;
      padding: 6px 14px;
      font-size: 12px;
      cursor: pointer;
      color: #64748b;
      font-weight: 500;
    }

    .toggle-pill button.active {
      background: #0fbe5b;
      color: #ffffff;
      box-shadow: 0 0 0 4px rgba(15, 190, 91, 0.18);
    }

    .toggle-helper {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 6px;
    }

    .inline-fields {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    .input, select, textarea {
      width: 100%;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 8px 12px;
      font-family: inherit;
      font-size: 13px;
      outline: none;
      background: #fbfdfc;
      color: var(--text-main);
    }

    textarea {
      border-radius: 14px;
      resize: vertical;
      min-height: 60px;
    }

    .input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(37, 196, 106, 0.45);
      background: #ffffff;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .pill-button {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      border: 1px solid var(--chip-border);
      background: var(--chip-bg);
      color: var(--text-soft);
      cursor: pointer;
    }

    .pill-button:hover {
      border-color: var(--accent);
      color: var(--accent-strong);
    }

    .primary-button {
      border-radius: 999px;
      width: 100%;
      border: none;
      margin-top: 8px;
      padding: 10px 14px;
      font-size: 14px;
      font-weight: 600;
      background: linear-gradient(135deg, #23c665, #15b357);
      color: #ffffff;
      cursor: pointer;
      box-shadow: 0 12px 25px rgba(15, 164, 80, 0.35);
    }

    .primary-button:hover {
      filter: brightness(1.03);
    }

    .secondary-button {
      border-radius: 999px;
      width: 100%;
      margin-top: 8px;
      padding: 9px 14px;
      font-size: 13px;
      font-weight: 500;
      border: 1px dashed #cfd8e3;
      background: #f8fafb;
      color: #64748b;
      cursor: pointer;
    }

    /* OUTPUT */

    .output {
      margin-top: 22px;
    }

    .budget-banner {
      border-radius: 18px;
      background: #e5f9ed;
      border: 1px solid #c1ecd5;
      padding: 10px 14px;
      font-size: 13px;
      margin-bottom: 14px;
    }

    .budget-banner strong {
      font-weight: 700;
    }

    .budget-banner-main {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .budget-banner-message {
      font-size: 12px;
      color: #285343;
    }

    .weekly-plan-header {
      margin-bottom: 8px;
    }

    .weekly-plan-header h3 {
      margin: 0 0 4px;
      font-size: 16px;
    }

    .weekly-plan-header p {
      margin: 0;
      font-size: 12px;
      color: var(--text-soft);
    }

    .days-grid {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    @media (min-width: 800px) {
      .days-grid {
        gap: 16px;
      }
    }

    .day-card {
      border-radius: 20px;
      border: 1px solid var(--border-soft);
      background: #fcfefc;
      padding: 12px 14px 14px;
    }

    .day-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
    }

    .day-header h4 {
      margin: 0;
      font-size: 14px;
    }

    .day-header span {
      font-size: 12px;
      color: var(--text-soft);
    }

    .meal-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 8px;
    }

    @media (min-width: 720px) {
      .meal-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .meal-tile {
      border-radius: 16px;
      border: 1px dashed #d8e5dd;
      background: #ffffff;
      padding: 9px 10px 10px;
    }

    .meal-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .meal-tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-bottom: 4px;
    }

    .tag-pill {
      border-radius: 999px;
      padding: 2px 7px;
      font-size: 10px;
      font-weight: 500;
      border: none;
      color: #1f2933;
    }

    .tag-busy {
      background: #e0edff;
      color: #23408f;
    }

    .tag-budget {
      background: #ddf9e7;
      color: #126638;
    }

    .tag-protein {
      background: #ffe9c2;
      color: #8b5a10;
    }

    .tag-quick {
      background: #ffe3e3;
      color: #9b1c1c;
    }

    .meal-meta {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 3px;
    }

    .meal-how-label {
      font-size: 11px;
      font-weight: 600;
      margin-top: 4px;
      margin-bottom: 2px;
    }

    .meal-how {
      margin: 0;
      padding-left: 18px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .meal-how li + li {
      margin-top: 2px;
    }

    .grocery-section {
      margin-top: 20px;
    }

    .grocery-section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .grocery-section-header h3 {
      margin: 0;
      font-size: 15px;
    }

    .grocery-section-header span {
      font-size: 12px;
      color: var(--text-soft);
    }

    .grocery-list-card {
      border-radius: 18px;
      border: 1px dashed #d7e5da;
      background: #fbfefb;
      padding: 10px 10px 8px;
      max-height: 420px;
      overflow-y: auto;
    }

    .grocery-item {
      border-radius: 14px;
      border: 1px dashed #dbe7dd;
      padding: 7px 9px;
      margin-bottom: 6px;
      background: #ffffff;
    }

    .grocery-item-title {
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .grocery-item-meta {
      font-size: 11px;
      color: var(--text-soft);
    }

    .grocery-item-best {
      font-size: 11px;
      color: #2f6843;
      margin-top: 2px;
    }

    .grocery-actions {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 10px;
    }

    @media (min-width: 520px) {
      .grocery-actions {
        flex-direction: row;
        justify-content: flex-start;
      }
      .grocery-actions button {
        width: auto;
        min-width: 160px;
      }
    }

    .footer-note {
      margin-top: 10px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .muted {
      color: var(--text-soft);
    }

    .warning {
      margin-top: 6px;
      padding: 6px 8px;
      border-radius: 10px;
      background: var(--danger-bg);
      color: var(--danger-text);
      font-size: 11px;
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="shell">
      <div class="hero">
        <section class="hero-main">
          <div class="hero-header">
            <div class="logo-pill">H</div>
            <div class="hero-title-block">
              <h1>Healthy Meal Engine</h1>
              <p>Turn your grocery budget into a simple, healthy, realistic plan.</p>
            </div>
          </div>

          <div class="focus-chips">
            <div class="focus-chip">
              <span class="focus-dot focus-dot--primary"></span>
              <div>
                <strong>Primary: Busy Worker</strong>
                <span>Max results ‚Ä¢ minimal cooking ‚Ä¢ still healthy</span>
              </div>
            </div>
            <div class="focus-chip">
              <span class="focus-dot focus-dot--secondary"></span>
              <div>
                <strong>Secondary: Budget-First</strong>
                <span>Stretch every dollar without eating trash</span>
              </div>
            </div>
          </div>

          <div class="hero-promise">
            <div class="hero-promise-title">Eat better on a real-person budget.</div>
            <div>No calorie math, no diet culture ‚Äî just practical meals and a grocery list that match your time, money, and cravings.</div>

            <div class="hero-badges">
              <div class="hero-badge">
                <span class="hero-badge-emoji">ü•ó</span>
                <span>3 meals + snacks</span>
              </div>
              <div class="hero-badge">
                <span class="hero-badge-emoji">üõí</span>
                <span>Grocery list included</span>
              </div>
              <div class="hero-badge">
                <span class="hero-badge-emoji">üí∏</span>
                <span>Budget-aware picks</span>
              </div>
            </div>

            <div class="hero-images">
              <div class="hero-img-main">
                <img src="https://images.unsplash.com/photo-1512621776951-a57141f2eefd?auto=format&fit=crop&w=1200&q=80" alt="Healthy bowl" />
              </div>
              <div class="hero-img">
                <img src="https://images.unsplash.com/photo-1514996937319-344454492b37?auto=format&fit=crop&w=800&q=80" alt="Cooking at home" />
              </div>
              <div class="hero-img">
                <img src="https://images.unsplash.com/photo-1508736793122-f516e3ba5569?auto=format&fit=crop&w=800&q=80" alt="Comfort food" />
              </div>
            </div>
          </div>
        </section>

        <section class="form-card">
          <h2>Build Your Week</h2>
          <p>Tell the engine how you actually live. We‚Äôll return meals and a grocery list that match your budget and energy.</p>

          <div class="field">
            <div class="field-label">Focus mode <span>Quick &amp; easy vs ultra-cheap.</span></div>
            <div class="toggle-pill">
              <button type="button" id="focus-busy" class="active" data-focus="busy">Busy Worker</button>
              <button type="button" id="focus-budget" data-focus="budget">Budget-First</button>
            </div>
            <div id="focus-helper" class="toggle-helper">
              Busy Worker: prioritizes quick-prep or ready-to-eat meals that still hit the health bar.
            </div>
          </div>

          <div class="field">
            <div class="field-label">Budget &amp; duration <span>Be honest so the math works.</span></div>
            <div class="inline-fields">
              <input id="total-budget" class="input" type="number" min="10" step="1" placeholder="Total budget ($)" />
              <input id="num-days" class="input" type="number" min="3" max="7" step="1" placeholder="# of days" />
            </div>
            <div class="pill-row" style="margin-top:6px;">
              <button class="pill-button" data-budget-preset="60-5">Solo ¬∑ 5 days ¬∑ ~$60</button>
              <button class="pill-button" data-budget-preset="75-5">Solo ¬∑ 5 days ¬∑ ~$75</button>
              <button class="pill-button" data-budget-preset="100-7">Solo ¬∑ 7 days ¬∑ ~$100</button>
            </div>
          </div>

          <div class="field">
            <div class="field-label">Eating style <span>We‚Äôll only show meals that fit.</span></div>
            <select id="eating-style">
              <option value="omnivore">Omnivore (no major restrictions)</option>
              <option value="no-dairy">Low-dairy</option>
              <option value="no-gluten">Gluten-light</option>
              <option value="no-seafood">No seafood</option>
              <option value="vegetarian">Mostly vegetarian</option>
            </select>
          </div>

          <div class="field">
            <div class="field-label">Hard no ingredients</div>
            <input id="hard-nos" class="input" placeholder='Comma-separated. e.g. "peanut butter, tuna, mushrooms".' />
          </div>

          <div class="field">
            <div class="field-label">Lifestyle constraints <span>(optional)</span></div>
            <textarea id="lifestyle-notes" placeholder='Short notes like "no oven", "office microwave only", "gym 3x nights". Add context so the plan feels like your real life.'></textarea>
          </div>

          <button id="generate-btn" class="primary-button" type="button">
            ‚ú® Generate meal plan
          </button>
        </section>
      </div>

      <section id="output" class="output" style="display:none;">
        <div id="budget-banner" class="budget-banner"></div>

        <div class="weekly-plan-header">
          <h3>Your Weekly Plan</h3>
          <p>Daily meals first, then a consolidated grocery list. Built for real life, not Pinterest perfection.</p>
        </div>

        <div id="days-grid" class="days-grid"></div>

        <section class="grocery-section">
          <div class="grocery-section-header">
            <div>
              <h3>Consolidated grocery list</h3>
              <span id="grocery-meta"></span>
            </div>
          </div>
          <div id="grocery-list" class="grocery-list-card"></div>

          <div class="grocery-actions">
            <button id="copy-grocery-btn" class="secondary-button" type="button">
              üìã Copy grocery list
            </button>
            <button id="download-pdf-btn" class="secondary-button" type="button">
              ‚¨áÔ∏è Download grocery PDF
            </button>
          </div>

          <div class="footer-note">
            Healthy Meal Engine ¬∑ v1.5 ‚Äì Cooking steps + store hints edition.  
            Prices are rough estimates based on discount-grocer style pricing. Your store may vary.
          </div>
        </section>
      </section>
    </div>
  </div>

  <!-- jsPDF library for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    // ---------- DATA (5-day baseline plan + grocery list) ----------

    const baselinePlan = [
      {
        day: 1,
        estDailyCost: 9.0,
        meals: [
          {
            slot: "BREAKFAST",
            title: "Overnight oats with chia & banana",
            tags: ["busy", "budget", "quick"],
            minutes: 5,
            cost: 1.5,
            steps: [
              "Add oats, chia seeds, and cinnamon to a jar or container.",
              "Pour in enough milk to fully cover the oats and stir.",
              "Refrigerate overnight; add sliced banana in the morning."
            ]
          },
          {
            slot: "LUNCH",
            title: "Hummus, veggie & feta wrap",
            tags: ["busy", "quick"],
            minutes: 7,
            cost: 2.5,
            steps: [
              "Spread hummus over the tortilla.",
              "Add sliced cucumber, shredded carrots, and a sprinkle of feta.",
              "Roll up tightly and slice in half if desired."
            ]
          },
          {
            slot: "DINNER",
            title: "Sheet pan chicken, potatoes & carrots",
            tags: ["budget", "protein"],
            minutes: 15,
            cost: 3.0,
            steps: [
              "Preheat oven to ~400¬∞F (200¬∞C) and line a sheet pan.",
              "Toss chicken, chopped potatoes, and carrots with olive oil and seasoning.",
              "Spread on the pan and roast 25‚Äì35 minutes until cooked through and browned."
            ]
          },
          {
            slot: "SNACKS",
            title: "Apple + peanut butter",
            tags: ["budget", "quick"],
            minutes: 2,
            cost: 1.0,
            steps: [
              "Slice an apple just before eating.",
              "Serve with a spoonful or two of peanut butter for dipping."
            ]
          },
          {
            slot: "BEVERAGES",
            title: "Water + flavor drops or lemon",
            tags: ["budget", "quick"],
            minutes: 1,
            cost: 0.1,
            steps: [
              "Fill a bottle or large cup with water.",
              "Squeeze in lemon or add a small amount of flavor drops.",
              "Sip throughout the day."
            ]
          }
        ]
      },
      {
        day: 2,
        estDailyCost: 8.5,
        meals: [
          {
            slot: "BREAKFAST",
            title: "Greek yogurt + berries + granola",
            tags: ["busy", "budget", "protein", "quick"],
            minutes: 3,
            cost: 2.4,
            steps: [
              "Scoop Greek yogurt into a bowl or container.",
              "Top with a handful of frozen berries.",
              "Sprinkle granola on top right before eating so it stays crunchy."
            ]
          },
          {
            slot: "LUNCH",
            title: "Tuna salad on whole grain toast",
            tags: ["budget", "protein"],
            minutes: 8,
            cost: 2.0,
            steps: [
              "Drain canned tuna and add to a bowl.",
              "Mix with Greek yogurt or light mayo and chopped pickles/celery.",
              "Toast bread and spread tuna salad on top."
            ]
          },
          {
            slot: "DINNER",
            title: "Sheet pan chicken, potatoes & carrots",
            tags: ["budget", "protein"],
            minutes: 15,
            cost: 3.0,
            steps: [
              "Repeat Day 1 sheet-pan method with chicken, potatoes and carrots.",
              "Roast until chicken is cooked through and potatoes are browned."
            ]
          },
          {
            slot: "SNACKS",
            title: "Apple + peanut butter",
            tags: ["budget", "quick"],
            minutes: 2,
            cost: 1.0,
            steps: [
              "Slice an apple just before eating.",
              "Serve with peanut butter for dipping."
            ]
          },
          {
            slot: "BEVERAGES",
            title: "Water + flavor drops or lemon",
            tags: ["budget", "quick"],
            minutes: 1,
            cost: 0.1,
            steps: [
              "Fill a bottle or cup with water.",
              "Add lemon or flavor drops and sip through the day."
            ]
          }
        ]
      },
      {
        day: 3,
        estDailyCost: 9.7,
        meals: [
          {
            slot: "BREAKFAST",
            title: "Overnight oats with chia & banana",
            tags: ["busy", "budget", "quick"],
            minutes: 5,
            cost: 1.5,
            steps: [
              "Repeat overnight oats prep from Day 1.",
              "Top with sliced banana in the morning."
            ]
          },
          {
            slot: "LUNCH",
            title: "Microwave-friendly frozen veggie + protein bowl",
            tags: ["busy", "quick"],
            minutes: 7,
            cost: 3.0,
            steps: [
              "Heat frozen grain & veggie bowl per package directions.",
              "Stir in extra rotisserie chicken for more protein.",
              "Season to taste with salt, pepper or hot sauce."
            ]
          },
          {
            slot: "DINNER",
            title: "Baked salmon, rice & green beans",
            tags: ["protein"],
            minutes: 12,
            cost: 4.2,
            steps: [
              "Preheat oven to ~400¬∞F (200¬∞C). Place salmon on a lined tray.",
              "Drizzle with olive oil, salt, pepper and lemon.",
              "Bake salmon 12‚Äì18 minutes depending on thickness.",
              "Cook rice and steam or microwave green beans; serve together."
            ]
          },
          {
            slot: "SNACKS",
            title: "Carrots & hummus",
            tags: ["busy", "budget", "quick"],
            minutes: 2,
            cost: 0.9,
            steps: [
              "Portion baby carrots into a container.",
              "Serve with a few spoonfuls of hummus for dipping."
            ]
          },
          {
            slot: "BEVERAGES",
            title: "Green tea",
            tags: ["budget", "quick"],
            minutes: 3,
            cost: 0.4,
            steps: [
              "Boil water and let it sit 1‚Äì2 minutes.",
              "Steep green tea bag 2‚Äì3 minutes.",
              "Remove bag to avoid bitterness."
            ]
          }
        ]
      },
      {
        day: 4,
        estDailyCost: 10.0,
        meals: [
          {
            slot: "BREAKFAST",
            title: "Greek yogurt + berries + granola",
            tags: ["busy", "budget", "protein", "quick"],
            minutes: 3,
            cost: 2.4,
            steps: [
              "Scoop yogurt into a bowl.",
              "Top with frozen berries and granola just before eating."
            ]
          },
          {
            slot: "LUNCH",
            title: "Tuna salad on whole grain toast",
            tags: ["budget", "protein"],
            minutes: 8,
            cost: 2.0,
            steps: [
              "Mix canned tuna with yogurt or light mayo and chopped pickles/celery.",
              "Serve on toasted whole-grain bread."
            ]
          },
          {
            slot: "DINNER",
            title: "Baked salmon, rice & green beans",
            tags: ["protein"],
            minutes: 12,
            cost: 4.2,
            steps: [
              "Repeat baked salmon & rice method from Day 3."
            ]
          },
          {
            slot: "SNACKS",
            title: "Apple + peanut butter",
            tags: ["budget", "quick"],
            minutes: 2,
            cost: 1.0,
            steps: [
              "Slice an apple.",
              "Serve with peanut butter."
            ]
          },
          {
            slot: "BEVERAGES",
            title: "Green tea",
            tags: ["budget", "quick"],
            minutes: 3,
            cost: 0.4,
            steps: [
              "Steep green tea as on Day 3."
            ]
          }
        ]
      },
      {
        day: 5,
        estDailyCost: 9.6,
        meals: [
          {
            slot: "BREAKFAST",
            title: "Protein smoothie (frozen fruit + protein powder)",
            tags: ["busy", "protein", "quick"],
            minutes: 4,
            cost: 2.2,
            steps: [
              "Add frozen fruit, protein powder and milk or water to a blender.",
              "Blend until smooth, adding more liquid as needed."
            ]
          },
          {
            slot: "LUNCH",
            title: "Hummus, veggie & feta wrap",
            tags: ["busy", "quick"],
            minutes: 7,
            cost: 2.5,
            steps: [
              "Spread hummus over a tortilla.",
              "Add cucumber, shredded carrots and feta.",
              "Roll up tightly and slice."
            ]
          },
          {
            slot: "DINNER",
            title: "Baked salmon, rice & green beans",
            tags: ["protein"],
            minutes: 12,
            cost: 4.2,
            steps: [
              "Bake salmon and prepare rice & green beans as on Day 3."
            ]
          },
          {
            slot: "SNACKS",
            title: "Low-sugar protein bar",
            tags: ["busy", "protein", "quick"],
            minutes: 1,
            cost: 1.5,
            steps: [
              "Keep a bar in your bag, desk or car.",
              "Grab one when you need quick protein on the go."
            ]
          },
          {
            slot: "BEVERAGES",
            title: "Green tea",
            tags: ["budget", "quick"],
            minutes: 3,
            cost: 0.4,
            steps: [
              "Prepare green tea as on earlier days."
            ]
          }
        ]
      }
    ];

    const groceryItems = [
      ["Milk or water", 0.3, "$2‚Äì$4", "Any grocery / big-box"],
      ["Water", 0.5, "$2‚Äì$4", "Any grocery store / big-box"],
      ["Flavor drops", 0.2, "$3‚Äì$5", "Any grocery store / big-box"],
      ["Whole grain bread", 0.5, "$2‚Äì$4", "Bakery or bread aisle (any grocery)"],
      ["Tortillas", 1.0, "$2‚Äì$4", "Bread/tortilla aisle (any grocery)"],
      ["Chia seeds", 0.4, "~$5", "Bulk aisle or online (Amazon)"],
      ["Canned tuna", 0.7, "$3‚Äì$5", "Canned goods aisle (any grocery)"],
      ["Granola", 0.6, "~$5", "Cereal aisle (big-box or grocery)"],
      ["Feta", 0.4, "$3‚Äì$5", "Cheese section (any grocery)"],
      ["Oat or almond milk", 0.8, "$3‚Äì$5", "Dairy alternative section (any grocery)"],
      ["Chicken thighs", 1.2, "~$8", "Discount grocer (Aldi/Lidl/Walmart)"],
      ["Rolled oats", 0.8, "$2‚Äì$4", "Discount grocer or bulk aisle"],
      ["Frozen salmon", 1.0, "~$10", "Freezer / seafood section"],
      ["Frozen grain veggie bowl", 1.0, "~$5", "Freezer aisle (big-box / grocery)"],
      ["Frozen berries", 0.9, "$3‚Äì$5", "Freezer aisle (discount grocer or big-box)"],
      ["Frozen green beans", 0.8, "$2‚Äì$4", "Frozen or produce section"],
      ["Rotisserie chicken", 0.8, "~$8", "Grocery deli / hot foods"],
      ["Olive oil", 0.7, "~$6", "Oils aisle (any grocery store / big-box)"],
      ["Protein powder", 0.3, "~$18", "Online/big-box (Amazon, Walmart, Target)"],
      ["Peanut butter", 0.3, "$2‚Äì$4", "Peanut butter/jam aisle"],
      ["Pickles or celery", 0.2, "$2‚Äì$4", "Pickle aisle or produce"],
      ["Bananas", 1.0, "$2‚Äì$4", "Produce section (any grocery)"],
      ["Cucumber", 0.6, "$1‚Äì$2", "Produce section (any grocery)"],
      ["Carrots", 1.6, "$2‚Äì$4", "Produce section (any grocery)"],
      ["Baby potatoes", 1.0, "$2‚Äì$4", "Produce section (any grocery)"],
      ["Apples", 0.4, "$2‚Äì$4", "Produce section (any grocery)"],
      ["Lemons", 0.4, "$2‚Äì$4", "Produce section (any grocery)"],
      ["Baby carrots", 0.5, "$1‚Äì$2", "Produce section (any grocery)"],
      ["Spinach", 0.3, "$1‚Äì$2", "Produce section (any grocery)"],
      ["Greek yogurt", 0.8, "~$5", "Refrigerated dairy (any grocery)"],
      ["Hummus", 1.0, "$3‚Äì$5", "Refrigerated dips (any grocery)"],
      ["Rice", 0.8, "$3‚Äì$5", "Rice/grains aisle (any grocery)"],
      ["Protein bars", 0.5, "~$7", "Snacks or nutrition aisle (big-box/grocery)"],
      ["Seasoning blend", 0.2, "$2‚Äì$4", "Spice aisle (any grocery)"],
      ["Green tea bags", 0.3, "$2‚Äì$4", "Tea/coffee aisle"]
    ];

    let currentGroceryListText = "";
    let currentEstimate = 67.5;

    // ---------- HELPERS ----------

    function formatMoney(value) {
      return "$" + value.toFixed(1).replace(/\.0$/, "");
    }

    function buildGroceryText() {
      const headerLines = [
        "Healthy Meal Engine ¬∑ Weekly Grocery Plan",
        "Total budget: {{BUDGET}} ¬∑ Estimated food cost: {{EST}}.",
        "",
        "Consolidated grocery list",
        "Grocery list from Healthy Meal Engine",
        ""
      ];

      const lines = groceryItems.map(([name, uses, budget, bestAt]) => {
        return `- ${name} ‚Äî ~${uses} uses this week, budget: ${budget} ‚Ä¢ ${bestAt}`;
      });

      const footer = [
        "",
        `Estimated food cost: ${formatMoney(currentEstimate)} (before tax).`
      ];

      return [...headerLines, ...lines, ...footer].join("\n");
    }

    function renderPlan(totalBudget, numDays, focusMode) {
      const output = document.getElementById("output");
      const daysGrid = document.getElementById("days-grid");
      const banner = document.getElementById("budget-banner");

      output.style.display = "block";
      daysGrid.innerHTML = "";

      const baselineDays = baselinePlan.slice(0, numDays);
      const estCostTotal = baselineDays.reduce((sum, d) => sum + d.estDailyCost, 0);
      currentEstimate = estCostTotal;

      // Banner
      const diff = totalBudget - estCostTotal;
      const status =
        diff >= 0
          ? `~${formatMoney(diff)} under budget (buffer for tax / price swings).`
          : `~${formatMoney(Math.abs(diff))} over budget ‚Äî consider trimming snacks or portions.`;

      const focusLabel =
        focusMode === "busy"
          ? "Busy Worker ‚Äî prioritizing quick-prep or ready-to-eat meals."
          : "Budget-First ‚Äî prioritizing cheaper ingredients & repeats.";

      banner.innerHTML = `
        <div class="budget-banner-main">
          <div><strong>Total budget:</strong> ${formatMoney(totalBudget)} ‚Ä¢ <strong>Estimated food cost:</strong> ${formatMoney(estCostTotal)}</div>
        </div>
        <div class="budget-banner-message">${status}</div>
        <div class="budget-banner-message">Focus: ${focusLabel}</div>
      `;

      // Days
      baselineDays.forEach((day) => {
        const dayCard = document.createElement("article");
        dayCard.className = "day-card";

        dayCard.innerHTML = `
          <div class="day-header">
            <h4>Day ${day.day}</h4>
            <span>Est. daily cost: ${formatMoney(day.estDailyCost)}</span>
          </div>
        `;

        const grid = document.createElement("div");
        grid.className = "meal-grid";

        day.meals.forEach((meal) => {
          const tile = document.createElement("div");
          tile.className = "meal-tile";

          const tagHtml = meal.tags
            .map((t) => {
              if (t === "busy") return `<span class="tag-pill tag-busy">busy-friendly</span>`;
              if (t === "budget") return `<span class="tag-pill tag-budget">budget pick</span>`;
              if (t === "protein") return `<span class="tag-pill tag-protein">high protein</span>`;
              if (t === "quick") return `<span class="tag-pill tag-quick">&lt;10 min prep</span>`;
              return "";
            })
            .join("");

          tile.innerHTML = `
            <div class="meal-title">${meal.slot}</div>
            <div class="meal-title" style="font-weight:500;margin-bottom:2px;">${meal.title}</div>
            <div class="meal-tag-row">${tagHtml}</div>
            <div class="meal-meta">${meal.minutes} min ‚Ä¢ ~${formatMoney(meal.cost)}/serv</div>
            <div class="meal-how-label">How to make:</div>
            <ul class="meal-how">
              ${meal.steps.map((s) => `<li>${s}</li>`).join("")}
            </ul>
          `;

          grid.appendChild(tile);
        });

        dayCard.appendChild(grid);
        daysGrid.appendChild(dayCard);
      });

      // Grocery list UI
      const groceryMeta = document.getElementById("grocery-meta");
      groceryMeta.textContent = `${groceryItems.length} unique items ¬∑ Est. food cost: ${formatMoney(estCostTotal)} (before tax)`;

      const groceryListDiv = document.getElementById("grocery-list");
      groceryListDiv.innerHTML = "";

      groceryItems.forEach(([name, uses, budget, bestAt]) => {
        const item = document.createElement("div");
        item.className = "grocery-item";
        item.innerHTML = `
          <div class="grocery-item-title">${name}</div>
          <div class="grocery-item-meta">~${uses} uses this week ‚Ä¢ budget: ${budget}</div>
          <div class="grocery-item-best">Best at: ${bestAt}</div>
        `;
        groceryListDiv.appendChild(item);
      });

      // Build shareable text + update PDF string
      let text = buildGroceryText();
      text = text
        .replace("{{BUDGET}}", formatMoney(totalBudget))
        .replace("{{EST}}", formatMoney(estCostTotal));
      currentGroceryListText = text;
    }

    // ---------- EVENT HANDLERS ----------

    const focusBusyBtn = document.getElementById("focus-busy");
    const focusBudgetBtn = document.getElementById("focus-budget");
    const focusHelper = document.getElementById("focus-helper");

    focusBusyBtn.addEventListener("click", () => {
      focusBusyBtn.classList.add("active");
      focusBudgetBtn.classList.remove("active");
      focusHelper.textContent =
        "Busy Worker: prioritizes quick-prep or ready-to-eat meals that still hit the health bar.";
    });

    focusBudgetBtn.addEventListener("click", () => {
      focusBudgetBtn.classList.add("active");
      focusBusyBtn.classList.remove("active");
      focusHelper.textContent =
        "Budget-First: reuses ingredients and leans on cheaper items to stretch every dollar.";
    });

    document.querySelectorAll("[data-budget-preset]").forEach((btn) => {
      btn.addEventListener("click", () => {
        const [budget, days] = btn.dataset.budgetPreset.split("-");
        document.getElementById("total-budget").value = budget;
        document.getElementById("num-days").value = days;
      });
    });

    document.getElementById("generate-btn").addEventListener("click", () => {
      const budgetInput = document.getElementById("total-budget").value;
      const daysInput = document.getElementById("num-days").value;

      const totalBudget = budgetInput ? parseFloat(budgetInput) : 60;
      const numDays = daysInput ? Math.min(5, Math.max(3, parseInt(daysInput, 10))) : 5;
      const focusMode = focusBusyBtn.classList.contains("active") ? "busy" : "budget";

      renderPlan(totalBudget, numDays, focusMode);
    });

    // Copy grocery list
    document.getElementById("copy-grocery-btn").addEventListener("click", () => {
      if (!currentGroceryListText) {
        alert("Generate a meal plan first.");
        return;
      }
      navigator.clipboard
        .writeText(currentGroceryListText)
        .then(() => alert("Grocery list copied to clipboard."))
        .catch(() => alert("Unable to copy. You can still select and copy manually."));
    });

    // PDF download
    document.getElementById("download-pdf-btn").addEventListener("click", () => {
      if (!window.jspdf || !window.jspdf.jsPDF) {
        alert("PDF library not loaded. Please check your internet connection and try again.");
        return;
      }
      if (!currentGroceryListText || !currentGroceryListText.trim()) {
        alert("No grocery list found. Generate a meal plan first.");
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: "pt", format: "a4" });

      const pageWidth = doc.internal.pageSize.getWidth();
      const pageHeight = doc.internal.pageSize.getHeight();
      const marginX = 40;
      const marginTop = 60;
      const marginBottom = 50;
      let cursorY = marginTop;

      // Header
      doc.setFont("helvetica", "bold");
      doc.setFontSize(18);
      doc.text("Healthy Meal Engine", marginX, cursorY);
      cursorY += 22;

      doc.setFont("helvetica", "normal");
      doc.setFontSize(12);
      doc.text("Weekly Grocery Plan ¬∑ Consolidated grocery list", marginX, cursorY);
      cursorY += 18;

      doc.setDrawColor(210);
      doc.line(marginX, cursorY, pageWidth - marginX, cursorY);
      cursorY += 18;

      doc.setFontSize(11);
      doc.setTextColor(30);

      const lines = currentGroceryListText
        .split("\n")
        .map((l) => l.trim())
        .filter((l) => l.length > 0);

      lines.forEach((line) => {
        const bullet = "‚Ä¢ " + line;
        const wrapped = doc.splitTextToSize(bullet, pageWidth - marginX * 2);
        const neededHeight = wrapped.length * 14 + 8;

        if (cursorY + neededHeight > pageHeight - marginBottom) {
          doc.addPage();
          cursorY = marginTop;
        }

        wrapped.forEach((wLine) => {
          doc.text(wLine, marginX, cursorY);
          cursorY += 14;
        });
        cursorY += 4;
      });

      // Footer
      cursorY = pageHeight - marginBottom + 12;
      doc.setFontSize(9);
      doc.setTextColor(120);
      doc.text(
        "Prices are rough estimates based on discount-grocer style pricing. Your store may vary.",
        marginX,
        cursorY
      );

      doc.save("Healthy-Meal-Engine-Grocery-List.pdf");
    });

    // Initial demo render so page isn't empty on first load
    renderPlan(60, 5, "busy");
  </script>
</body>
</html>

Here‚Äôs a complete new index.html you can paste straight into GitHub (replace the existing one).

It includes:
	‚Ä¢	Light, bright UI with food images
	‚Ä¢	Busy Worker vs Budget-First focus toggle
	‚Ä¢	3 meals + snacks + beverages per day
	‚Ä¢	Daily cost + tags (busy-friendly, budget pick, high protein, <10 min prep)
	‚Ä¢	Consolidated grocery list with:
	‚Ä¢	‚Äú~uses this week‚Äù
	‚Ä¢	Budget range
	‚Ä¢	‚ÄúBest at‚Äù / store-hint text
	‚Ä¢	Copy grocery list button
	‚Ä¢	Cleaned-up PDF download (title + summary + same grocery text)

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Healthy Meal Engine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Turn your grocery budget into a simple, realistic, healthy meal plan with a consolidated grocery list." />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <!-- jsPDF for PDF download -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"
          integrity="sha512-YkqFVh2qS0bkkCm1cWg6CHg8Gqv0Cq2Dq3YHk6Sj7tKQ6VkTgE63FQ3c5B6P7p6uI9zJ5dS1TQJqE5s4oK2nkw=="
          crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <style>
    :root {
      --bg-main: #f5fbf5;
      --bg-card: #ffffff;
      --bg-card-soft: #e8f9e9;
      --accent: #16a34a;
      --accent-soft: #dcfce7;
      --accent-strong: #15803d;
      --danger-soft: #fee2e2;
      --danger: #ef4444;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border-subtle: #e5e7eb;
      --pill-blue: #2563eb;
      --pill-blue-soft: #dbeafe;
      --pill-yellow: #f59e0b;
      --pill-yellow-soft: #fef3c7;
      --pill-green: #16a34a;
      --pill-green-soft: #dcfce7;
      --pill-red: #f97373;
      --pill-red-soft: #fee2e2;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.08);
      --radius-lg: 22px;
      --radius-md: 16px;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--text-main);
      background: radial-gradient(circle at top, #e0fce7, #f5fbf5 40%, #eef2ff);
      display: flex;
      justify-content: center;
      padding: 24px 12px 40px;
    }

    main {
      width: 100%;
      max-width: 1000px;
    }

    .shell {
      background: rgba(255, 255, 255, 0.92);
      border-radius: 28px;
      box-shadow: var(--shadow-soft);
      padding: 22px 18px 26px;
      backdrop-filter: blur(10px);
    }

    @media (min-width: 768px) {
      .shell {
        padding: 28px 28px 32px;
      }
    }

    .header-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 18px;
    }

    @media (min-width: 880px) {
      .header-grid {
        grid-template-columns: minmax(0, 1.35fr) minmax(0, 1fr);
        align-items: stretch;
      }
    }

    .hero-card {
      background: linear-gradient(135deg, #ecfdf5, #f0f9ff);
      border-radius: var(--radius-lg);
      padding: 18px 18px 20px;
      border: 1px solid rgba(148, 163, 184, 0.28);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .brand-row {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .brand-icon {
      width: 40px;
      height: 40px;
      border-radius: 16px;
      background: radial-gradient(circle at top, #22c55e, #16a34a);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ecfdf5;
      font-weight: 700;
      font-size: 1.1rem;
      box-shadow: 0 10px 25px rgba(34, 197, 94, 0.45);
    }

    .brand-text h1 {
      margin: 0;
      font-size: 1.35rem;
      letter-spacing: 0.01em;
    }

    .brand-text p {
      margin: 2px 0 0;
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    .audience-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }

    .audience-pill {
      border-radius: 999px;
      padding: 6px 11px;
      background: #ffffff;
      box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.35);
      display: flex;
      gap: 8px;
      align-items: center;
      font-size: 0.74rem;
      color: var(--text-main);
    }

    .audience-pill .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
    }

    .audience-pill.secondary .dot {
      background: #4f46e5;
    }

    .audience-label {
      font-weight: 600;
    }

    .audience-sub {
      color: var(--text-muted);
    }

    .hero-copy {
      margin-top: 6px;
      font-size: 0.9rem;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .hero-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      padding: 5px 10px;
      background: rgba(22, 163, 74, 0.08);
      font-size: 0.72rem;
      color: var(--text-main);
    }

    .chip span.emoji {
      font-size: 0.85rem;
    }

    /* Image strip */
    .food-strip {
      margin-top: 10px;
      border-radius: 18px;
      overflow: hidden;
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 2px;
      background: #ecfdf5;
    }

    .food-strip img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .food-strip-small {
      display: grid;
      grid-template-rows: 1fr 1fr;
      gap: 2px;
    }

    .food-strip-small img:last-child {
      filter: saturate(0.9);
    }

    /* Builder card */

    .builder-card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 16px 16px 20px;
      border: 1px solid var(--border-subtle);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .builder-card h2 {
      margin: 0 0 4px;
      font-size: 1.05rem;
    }

    .builder-sub {
      margin: 0;
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    .step-label {
      font-size: 0.74rem;
      font-weight: 600;
      color: var(--accent-strong);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 4px;
    }

    .field {
      margin-top: 8px;
    }

    .field label {
      display: block;
      font-size: 0.8rem;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .field small {
      display: block;
      font-size: 0.72rem;
      color: var(--text-muted);
      margin-top: 2px;
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      font: inherit;
      font-size: 0.86rem;
      color: var(--text-main);
      background: #f9fafb;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: 2px solid rgba(22, 163, 74, 0.25);
      border-color: rgba(22, 163, 74, 0.5);
      background: #ffffff;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    .two-col {
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 8px;
    }

    .focus-toggle {
      display: inline-flex;
      border-radius: 999px;
      background: #f3f4f6;
      padding: 3px;
      gap: 3px;
    }

    .focus-toggle button {
      border: none;
      flex: 1;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 0.78rem;
      cursor: pointer;
      background: transparent;
      color: var(--text-muted);
      font-weight: 500;
    }

    .focus-toggle button.active {
      background: var(--accent-soft);
      color: var(--accent-strong);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.6);
    }

    .helper-text {
      margin-top: 3px;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .cta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .btn {
      border-radius: 999px;
      padding: 9px 16px;
      font-size: 0.86rem;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      letter-spacing: 0.01em;
    }

    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      box-shadow: 0 10px 25px rgba(34, 197, 94, 0.4);
    }

    .btn-secondary {
      background: #eff6ff;
      color: #1d4ed8;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-muted);
      border: 1px solid var(--border-subtle);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }

    .btn span.icon {
      font-size: 1rem;
    }

    /* Output area */

    .output-wrapper {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .note-banner {
      border-radius: 18px;
      padding: 10px 12px;
      background: #ecfeff;
      border: 1px dashed #22c55e33;
      font-size: 0.76rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .note-banner strong {
      color: var(--text-main);
    }

    .plan-summary {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      padding: 14px 14px 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
    }

    .summary-main {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.86rem;
    }

    .summary-bubble {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border-radius: 999px;
      padding: 6px 12px;
      background: var(--accent-soft);
      color: var(--accent-strong);
      font-size: 0.8rem;
      font-weight: 600;
    }

    .summary-line {
      font-size: 0.84rem;
      color: var(--text-muted);
    }

    /* Day cards */

    .days-grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .day-card {
      border-radius: var(--radius-lg);
      background: #ffffff;
      border: 1px solid var(--border-subtle);
      padding: 12px 12px 14px;
    }

    .day-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .day-title {
      font-weight: 600;
      font-size: 0.92rem;
    }

    .day-cost {
      font-size: 0.8rem;
      color: var(--text-muted);
      background: #f9fafb;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
    }

    .meals-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 10px;
    }

    @media (min-width: 720px) {
      .meals-grid {
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }
    }

    .meal-card {
      border-radius: var(--radius-md);
      background: #f9fafb;
      border: 1px dashed #e5e7eb;
      padding: 8px 9px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .meal-title {
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .pill {
      border-radius: 999px;
      padding: 2px 7px;
      font-size: 0.68rem;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: lowercase;
    }

    .pill.busy {
      background: var(--pill-blue-soft);
      color: var(--pill-blue);
    }

    .pill.budget {
      background: var(--pill-green-soft);
      color: var(--pill-green);
    }

    .pill.protein {
      background: var(--pill-yellow-soft);
      color: var(--pill-yellow);
    }

    .pill.quick {
      background: var(--pill-red-soft);
      color: var(--pill-red);
    }

    .pill-meta {
      margin-top: 2px;
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .meal-how {
      margin-top: 4px;
      font-size: 0.73rem;
      color: var(--text-main);
    }

    .meal-how ul {
      padding-left: 16px;
      margin: 2px 0 0;
    }

    .meal-how li {
      margin-bottom: 3px;
    }

    /* Grocery list */

    .grocery-card {
      margin-top: 6px;
      border-radius: var(--radius-lg);
      background: #ffffff;
      border: 1px solid var(--border-subtle);
      padding: 12px 12px 14px;
    }

    .grocery-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .grocery-header-row h3 {
      margin: 0;
      font-size: 0.95rem;
    }

    .grocery-sub {
      font-size: 0.76rem;
      color: var(--text-muted);
    }

    .grocery-items {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 420px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .grocery-row {
      border-radius: 14px;
      border: 1px dashed #e5e7eb;
      padding: 7px 9px;
      background: #f9fafb;
      font-size: 0.78rem;
    }

    .grocery-top {
      display: flex;
      justify-content: space-between;
      gap: 4px;
      flex-wrap: wrap;
    }

    .grocery-name {
      font-weight: 600;
    }

    .grocery-usage {
      font-size: 0.76rem;
      color: var(--text-muted);
    }

    .grocery-meta {
      margin-top: 2px;
      font-size: 0.74rem;
      color: var(--text-muted);
    }

    .copy-row {
      display: flex;
      justify-content: flex-end;
      margin-top: 10px;
    }

    .copy-row .btn-ghost {
      font-size: 0.8rem;
      padding: 7px 12px;
    }

    footer {
      margin-top: 16px;
      font-size: 0.7rem;
      color: var(--text-muted);
      text-align: center;
    }

  </style>
</head>

<body>
<main>
  <div class="shell">
    <section class="header-grid">
      <!-- LEFT: brand + pitch + images -->
      <div class="hero-card">
        <div class="brand-row">
          <div class="brand-icon">H</div>
          <div class="brand-text">
            <h1>Healthy Meal Engine</h1>
            <p>Turn your grocery budget into a simple, healthy, realistic plan.</p>
          </div>
        </div>

        <div class="audience-row">
          <div class="audience-pill">
            <span class="dot"></span>
            <div>
              <div class="audience-label">Primary: Busy Worker</div>
              <div class="audience-sub">Max results ‚Ä¢ minimal cooking ‚Ä¢ still healthy</div>
            </div>
          </div>
          <div class="audience-pill secondary">
            <span class="dot"></span>
            <div>
              <div class="audience-label">Secondary: Budget-First</div>
              <div class="audience-sub">Stretch every dollar without eating trash</div>
            </div>
          </div>
        </div>

        <p class="hero-copy">
          No calorie math, no perfection. Just practical meals and a grocery list that match your time,
          money, and energy level.
        </p>

        <div class="hero-badges">
          <div class="chip"><span class="emoji">ü•ó</span>3 meals + snacks covered</div>
          <div class="chip"><span class="emoji">üßæ</span>Consolidated grocery list</div>
          <div class="chip"><span class="emoji">‚è±</span>Busy-friendly prep times</div>
        </div>

        <div class="food-strip">
          <img src="https://images.pexels.com/photos/1640777/pexels-photo-1640777.jpeg?auto=compress&cs=tinysrgb&w=800"
               alt="Healthy bowls" />
          <div class="food-strip-small">
            <img src="https://images.pexels.com/photos/3738762/pexels-photo-3738762.jpeg?auto=compress&cs=tinysrgb&w=800"
                 alt="Cooking at home" />
            <img src="https://images.pexels.com/photos/1639562/pexels-photo-1639562.jpeg?auto=compress&cs=tinysrgb&w=800"
                 alt="Comfort food" />
          </div>
        </div>
      </div>

      <!-- RIGHT: Builder -->
      <div class="builder-card">
        <h2>Build Your Week</h2>
        <p class="builder-sub">
          Tell the engine how you actually live. We‚Äôll return meals and a grocery list that match your
          budget and energy.
        </p>

        <div class="field">
          <div class="step-label">Step 1 ‚Ä¢ Focus + budget</div>
          <label>Focus mode</label>
          <div class="focus-toggle" id="focus-toggle">
            <button type="button" data-mode="busy" class="active">Busy Worker</button>
            <button type="button" data-mode="budget">Budget-First</button>
          </div>
          <div class="helper-text">
            Busy Worker prioritizes quick-prep or ready-to-eat meals. Budget-First leans harder on ultra-cheap staples.
          </div>
        </div>

        <div class="field two-col">
          <div>
            <label for="total-budget">Total budget ($)</label>
            <input id="total-budget" type="number" min="10" step="1" placeholder="e.g. 75" />
          </div>
          <div>
            <label for="days">How many days?</label>
            <select id="days">
              <option value="5" selected>5 days</option>
              <option value="7">7 days</option>
            </select>
          </div>
        </div>

        <div class="field">
          <div class="step-label">Step 2 ‚Ä¢ Eating style</div>
          <label for="eating-style">Eating style</label>
          <select id="eating-style">
            <option value="omnivore" selected>Omnivore (no major restrictions)</option>
            <option value="no-pork">No pork</option>
            <option value="no-red-meat">No red meat</option>
            <option value="vegetarian">Vegetarian (eggs & dairy okay)</option>
            <option value="pescatarian">Pescatarian</option>
          </select>
          <small>We‚Äôll only show meals that fit.</small>
        </div>

        <div class="field">
          <label for="no-ingredients">Hard no ingredients</label>
          <input id="no-ingredients" type="text" placeholder='Comma-separated. e.g. "peanut butter, tuna, mushrooms"' />
          <small>We‚Äôll avoid these entirely.</small>
        </div>

        <div class="field">
          <div class="step-label">Step 3 ‚Ä¢ Lifestyle constraints (optional)</div>
          <label for="constraints">Anything we should know?</label>
          <textarea id="constraints" placeholder='Short notes like "no oven", "office microwave only", "gym 3x nights".'></textarea>
          <small>Add context so the plan feels like your real life.</small>
        </div>

        <div class="cta-row">
          <button class="btn btn-primary" id="generate-btn">
            <span class="icon">‚ú®</span>
            <span>Generate meal plan</span>
          </button>
          <button class="btn btn-secondary" id="download-pdf-btn" disabled>
            <span class="icon">üìÑ</span>
            <span>Download as PDF</span>
          </button>
        </div>
      </div>
    </section>

    <!-- Output -->
    <section class="output-wrapper" id="output-section" style="display:none;">
      <div class="note-banner">
        <span>
          <strong>Heads up:</strong> Prices are rough estimates based on discount-grocer style pricing.
          Your store may vary.
        </span>
        <span>Re-run this anytime when your budget or schedule changes.</span>
      </div>

      <div id="plan-summary" class="plan-summary"></div>
      <div id="days-container" class="days-grid"></div>
      <div id="grocery-container" class="grocery-card"></div>
    </section>

    <footer>
      Healthy Meal Engine ¬∑ v1.4 ‚Äî Cooking steps + store hints edition
    </footer>
  </div>
</main>

<script>
  // -----------------------------
  // GLOBAL STATE
  // -----------------------------
  let lastGeneratedPlan = null;
  let lastGroceryText = "";

  // -----------------------------
  // DATA: INGREDIENT HINTS
  // -----------------------------
  const INGREDIENT_HINTS = {
    "Milk Or Water": { storeHint: "Any grocery / big-box", budgetRange: "$2‚Äì$4" },
    "Water": { storeHint: "Any grocery store / big-box", budgetRange: "$2‚Äì$4" },
    "Flavor Drops": { storeHint: "Any grocery store / big-box", budgetRange: "$3‚Äì$5" },
    "Whole Grain Bread": { storeHint: "Bakery or bread aisle (any grocery)", budgetRange: "$2‚Äì$4" },
    "Tortillas": { storeHint: "Bread/tortilla aisle (any grocery)", budgetRange: "$2‚Äì$4" },
    "Chia Seeds": { storeHint: "Bulk aisle or online (Amazon)", budgetRange: "~$5" },
    "Canned Tuna": { storeHint: "Canned goods aisle (any grocery)", budgetRange: "$3‚Äì$5" },
    "Granola": { storeHint: "Cereal aisle (big-box or grocery)", budgetRange: "~$5" },
    "Feta": { storeHint: "Cheese section (any grocery)", budgetRange: "$3‚Äì$5" },
    "Oat Or Almond Milk": { storeHint: "Dairy alternative section (any grocery)", budgetRange: "$3‚Äì$5" },
    "Chicken Thighs": { storeHint: "Discount grocer (Aldi/Lidl/Walmart)", budgetRange: "~$8" },
    "Rolled Oats": { storeHint: "Discount grocer or bulk aisle", budgetRange: "$2‚Äì$4" },
    "Frozen Salmon": { storeHint: "Freezer / seafood section", budgetRange: "~$10" },
    "Frozen Grain Veggie Bowl": { storeHint: "Freezer aisle (big-box / grocery)", budgetRange: "~$5" },
    "Frozen Berries": { storeHint: "Freezer aisle (discount grocer or big-box)", budgetRange: "$3‚Äì$5" },
    "Frozen Green Beans": { storeHint: "Frozen or produce section", budgetRange: "$2‚Äì$4" },
    "Rotisserie Chicken": { storeHint: "Grocery deli / hot foods", budgetRange: "~$8" },
    "Olive Oil": { storeHint: "Oils aisle (any grocery store / big-box)", budgetRange: "~$6" },
    "Protein Powder": { storeHint: "Online/big-box (Amazon, Walmart, Target)", budgetRange: "~$18" },
    "Peanut Butter": { storeHint: "Peanut butter/jam aisle", budgetRange: "$2‚Äì$4" },
    "Pickles Or Celery": { storeHint: "Pickle aisle or produce", budgetRange: "$2‚Äì$4" },
    "Bananas": { storeHint: "Produce section (any grocery)", budgetRange: "$2‚Äì$4" },
    "Cucumber": { storeHint: "Produce section (any grocery)", budgetRange: "$1‚Äì$2" },
    "Carrots": { storeHint: "Produce section (any grocery)", budgetRange: "$2‚Äì$4" },
    "Baby Potatoes": { storeHint: "Produce section (any grocery)", budgetRange: "$2‚Äì$4" },
    "Apples": { storeHint: "Produce section (any grocery)", budgetRange: "$2‚Äì$4" },
    "Lemons": { storeHint: "Produce section (any grocery)", budgetRange: "$2‚Äì$4" },
    "Baby Carrots": { storeHint: "Produce section (any grocery)", budgetRange: "$1‚Äì$2" },
    "Spinach": { storeHint: "Produce section (any grocery)", budgetRange: "$1‚Äì$2" },
    "Greek Yogurt": { storeHint: "Refrigerated dairy (any grocery)", budgetRange: "~$5" },
    "Hummus": { storeHint: "Refrigerated dips (any grocery)", budgetRange: "$3‚Äì$5" },
    "Rice": { storeHint: "Rice/grains aisle (any grocery)", budgetRange: "$3‚Äì$5" },
    "Protein Bars": { storeHint: "Snacks or nutrition aisle (big-box/grocery)", budgetRange: "~$7" },
    "Seasoning Blend": { storeHint: "Spice aisle (any grocery)", budgetRange: "$2‚Äì$4" },
    "Green Tea Bags": { storeHint: "Tea/coffee aisle", budgetRange: "$2‚Äì$4" }
  };

  // -----------------------------
  // DATA: MEALS
  // -----------------------------
  // Each meal has: title, tags, prepMin, costPerServ, ingredients[], instructions[]
  const MEALS = {
    breakfast: [
      {
        id: "oats-chia-banana",
        title: "Overnight oats with chia & banana",
        tags: ["busy", "budget", "quick", "protein"],
        prepMin: 5,
        costPerServ: 1.5,
        ingredients: [
          "Rolled Oats",
          "Chia Seeds",
          "Cinnamon",
          "Milk Or Water",
          "Bananas"
        ],
        instructions: [
          "Add oats, chia seeds, and cinnamon to a jar or container.",
          "Pour in enough milk or water to fully cover the oats and stir.",
          "Refrigerate overnight; add sliced banana in the morning."
        ]
      },
      {
        id: "yogurt-berries-granola",
        title: "Greek yogurt + berries + granola",
        tags: ["busy", "budget", "protein", "quick"],
        prepMin: 3,
        costPerServ: 2.4,
        ingredients: [
          "Greek Yogurt",
          "Frozen Berries",
          "Granola"
        ],
        instructions: [
          "Scoop Greek yogurt into a bowl or container.",
          "Top with a handful of frozen berries.",
          "Sprinkle granola on top right before eating so it stays crunchy."
        ]
      },
      {
        id: "protein-smoothie",
        title: "Protein smoothie (fruit + powder)",
        tags: ["busy", "protein", "quick"],
        prepMin: 4,
        costPerServ: 2.2,
        ingredients: [
          "Frozen Berries",
          "Milk Or Water",
          "Protein Powder",
          "Spinach"
        ],
        instructions: [
          "Add frozen fruit, protein powder, spinach, and liquid to a blender.",
          "Blend until smooth, adjusting liquid for desired thickness."
        ]
      }
    ],
    lunch: [
      {
        id: "hummus-wrap",
        title: "Hummus, veggie & feta wrap",
        tags: ["busy", "quick"],
        prepMin: 7,
        costPerServ: 2.5,
        ingredients: [
          "Tortillas",
          "Hummus",
          "Cucumber",
          "Carrots",
          "Feta"
        ],
        instructions: [
          "Spread hummus over the tortilla.",
          "Add sliced cucumber, shredded carrots, and a sprinkle of feta.",
          "Roll up tightly and slice in half if desired."
        ]
      },
      {
        id: "tuna-toast",
        title: "Tuna salad on whole grain toast",
        tags: ["budget", "protein"],
        prepMin: 8,
        costPerServ: 2.0,
        ingredients: [
          "Canned Tuna",
          "Greek Yogurt",
          "Pickles Or Celery",
          "Whole Grain Bread"
        ],
        instructions: [
          "Drain canned tuna and add to a bowl.",
          "Mix with Greek yogurt and chopped pickles or celery.",
          "Toast bread and spread tuna salad on top."
        ]
      },
      {
        id: "frozen-bowl",
        title: "Microwave-friendly veggie + protein bowl",
        tags: ["busy", "quick"],
        prepMin: 6,
        costPerServ: 3.0,
        ingredients: [
          "Frozen Grain Veggie Bowl",
          "Rotisserie Chicken"
        ],
        instructions: [
          "Heat frozen grain & veggie bowl per package directions.",
          "Shred rotisserie chicken and stir into the bowl for extra protein."
        ]
      }
    ],
    dinner: [
      {
        id: "sheet-pan-chicken",
        title: "Sheet pan chicken, potatoes & carrots",
        tags: ["budget", "protein"],
        prepMin: 15,
        costPerServ: 3.0,
        ingredients: [
          "Chicken Thighs",
          "Baby Potatoes",
          "Carrots",
          "Olive Oil",
          "Seasoning Blend"
        ],
        instructions: [
          "Preheat oven to ~400¬∞F (200¬∞C) and line a sheet pan.",
          "Toss chicken, chopped potatoes, and carrots with olive oil and seasoning.",
          "Spread on the pan and roast 25‚Äì35 minutes until cooked through and browned."
        ]
      },
      {
        id: "baked-salmon",
        title: "Baked salmon, rice & green beans",
        tags: ["protein"],
        prepMin: 12,
        costPerServ: 4.2,
        ingredients: [
          "Frozen Salmon",
          "Rice",
          "Frozen Green Beans",
          "Olive Oil",
          "Lemons"
        ],
        instructions: [
          "Preheat oven to ~400¬∞F (200¬∞C). Place salmon on a lined tray; drizzle with olive oil, salt, pepper, and lemon.",
          "Bake salmon 12‚Äì18 minutes depending on thickness.",
          "Cook rice and steam or microwave green beans; serve together."
        ]
      },
      {
        id: "lazy-chicken-bowl",
        title: "Lazy rotisserie chicken rice bowl",
        tags: ["busy", "budget"],
        prepMin: 10,
        costPerServ: 3.2,
        ingredients: [
          "Rotisserie Chicken",
          "Rice",
          "Spinach",
          "Olive Oil"
        ],
        instructions: [
          "Reheat rice and chopped rotisserie chicken.",
          "Toss with fresh spinach and a drizzle of olive oil.",
          "Season to taste and serve in a bowl."
        ]
      }
    ],
    snacks: [
      {
        id: "apple-pb",
        title: "Apple + peanut butter",
        tags: ["budget", "quick"],
        prepMin: 2,
        costPerServ: 1.0,
        ingredients: ["Apples", "Peanut Butter"],
        instructions: [
          "Slice an apple just before eating.",
          "Serve with a spoonful or two of peanut butter for dipping."
        ]
      },
      {
        id: "carrots-hummus",
        title: "Carrots & hummus",
        tags: ["busy", "budget", "quick"],
        prepMin: 2,
        costPerServ: 0.9,
        ingredients: ["Baby Carrots", "Hummus"],
        instructions: [
          "Portion baby carrots into a container.",
          "Add a scoop of hummus for dipping."
        ]
      },
      {
        id: "protein-bar",
        title: "Low-sugar protein bar",
        tags: ["busy", "protein", "quick"],
        prepMin: 1,
        costPerServ: 1.5,
        ingredients: ["Protein Bars"],
        instructions: [
          "Keep a few bars in your bag, desk, or car.",
          "Grab one when you need quick protein on the go."
        ]
      }
    ],
    beverages: [
      {
        id: "green-tea",
        title: "Green tea",
        tags: ["budget", "quick"],
        prepMin: 3,
        costPerServ: 0.4,
        ingredients: ["Green Tea Bags"],
        instructions: [
          "Boil water and let it sit 1‚Äì2 minutes to cool slightly.",
          "Steep green tea bag 2‚Äì3 minutes.",
          "Remove bag to avoid bitterness."
        ]
      },
      {
        id: "water-flavor",
        title: "Water + flavor drops or lemon",
        tags: ["budget", "quick"],
        prepMin: 1,
        costPerServ: 0.1,
        ingredients: ["Water", "Flavor Drops", "Lemons"],
        instructions: [
          "Fill a bottle or large cup with water.",
          "Squeeze in lemon or add a small amount of flavor drops.",
          "Sip throughout the day."
        ]
      }
    ]
  };

  // -----------------------------
  // UTILITIES
  // -----------------------------
  function pickRandom(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  function roundToTenths(num) {
    return Math.round(num * 10) / 10;
  }

  function parseNoIngredients(input) {
    if (!input) return [];
    return input
      .split(",")
      .map(s => s.trim().toLowerCase())
      .filter(Boolean);
  }

  function filterMealsForStyle(mealList, eatingStyle, noIngredients) {
    return mealList.filter(meal => {
      // simple ingredient filter
      const hasBlocked = meal.ingredients.some(ing =>
        noIngredients.some(block => ing.toLowerCase().includes(block))
      );
      if (hasBlocked) return false;

      if (eatingStyle === "vegetarian") {
        const banned = ["Chicken", "Salmon", "Tuna", "Rotisserie"];
        return !meal.ingredients.some(ing =>
          banned.some(b => ing.includes(b))
        );
      }
      if (eatingStyle === "pescatarian") {
        const banned = ["Chicken", "Rotisserie"];
        return !meal.ingredients.some(ing =>
          banned.some(b => ing.includes(b))
        );
      }
      if (eatingStyle === "no-pork") {
        // none of our core meals use pork right now, so always OK
        return true;
      }
      if (eatingStyle === "no-red-meat") {
        // none either
        return true;
      }
      return true;
    });
  }

  function createTagPills(tags) {
    const frag = document.createDocumentFragment();
    tags.forEach(tag => {
      const span = document.createElement("span");
      span.classList.add("pill");
      if (tag === "busy") span.classList.add("busy");
      if (tag === "budget") span.classList.add("budget");
      if (tag === "protein") span.classList.add("protein");
      if (tag === "quick") span.classList.add("quick");
      span.textContent =
        tag === "busy" ? "busy-friendly" :
        tag === "budget" ? "budget pick" :
        tag === "protein" ? "high protein" :
        tag === "quick" ? "<10 min prep" : tag;
      frag.appendChild(span);
    });
    return frag;
  }

  // -----------------------------
  // PLAN GENERATION
  // -----------------------------
  function generatePlan() {
    const mode = document
      .querySelector("#focus-toggle button.active")
      .getAttribute("data-mode");

    const budgetInput = document.getElementById("total-budget");
    const daysInput = document.getElementById("days");
    const eatingStyle = document.getElementById("eating-style").value;
    const noIngredientsRaw = document.getElementById("no-ingredients").value.trim();

    const totalBudget = budgetInput.value ? parseFloat(budgetInput.value) : 100;
    const numDays = parseInt(daysInput.value, 10) || 5;
    const noIngredients = parseNoIngredients(noIngredientsRaw);

    // Filter meals by style + hard no ingredients
    const breakfastMeals = filterMealsForStyle(MEALS.breakfast, eatingStyle, noIngredients);
    const lunchMeals = filterMealsForStyle(MEALS.lunch, eatingStyle, noIngredients);
    const dinnerMeals = filterMealsForStyle(MEALS.dinner, eatingStyle, noIngredients);
    const snackMeals = filterMealsForStyle(MEALS.snacks, eatingStyle, noIngredients);
    const beverageMeals = filterMealsForStyle(MEALS.beverages, eatingStyle, noIngredients);

    const days = [];
    let estimatedFoodCost = 0;

    const ingredientUsage = {};

    for (let i = 0; i < numDays; i++) {
      const dayIndex = i + 1;

      // For busy mode, bias toward busy + quick tags
      function pickFrom(list, fallbackList) {
        if (mode === "busy") {
          const strong = list.filter(m =>
            m.tags.includes("busy") || m.tags.includes("quick")
          );
          if (strong.length > 0) return pickRandom(strong);
        }
        return pickRandom(list.length ? list : fallbackList);
      }

      const breakfast = pickFrom(breakfastMeals, MEALS.breakfast);
      const lunch = pickFrom(lunchMeals, MEALS.lunch);
      const dinner = pickFrom(dinnerMeals, MEALS.dinner);
      const snack = pickFrom(snackMeals, MEALS.snacks);
      const beverage = pickFrom(beverageMeals, MEALS.beverages);

      const mealsForDay = [breakfast, lunch, dinner, snack, beverage];
      const dailyCost = mealsForDay.reduce(
        (sum, m) => sum + (m ? m.costPerServ : 0),
        0
      );
      estimatedFoodCost += dailyCost;

      // Track ingredient usage
      mealsForDay.forEach(m => {
        if (!m) return;
        m.ingredients.forEach(ing => {
          ingredientUsage[ing] = (ingredientUsage[ing] || 0) + 1 / numDays; // "uses this week" approx
        });
      });

      days.push({
        label: `Day ${dayIndex}`,
        dailyCost: roundToTenths(dailyCost),
        meals: { breakfast, lunch, dinner, snack, beverage }
      });
    }

    estimatedFoodCost = roundToTenths(estimatedFoodCost);

    const grocerySummary = Object.keys(ingredientUsage)
      .sort((a, b) => a.localeCompare(b))
      .map(name => {
        const approxUses = roundToTenths(ingredientUsage[name]);
        const meta = INGREDIENT_HINTS[name] || {
          storeHint: "Any grocery store",
          budgetRange: "$2‚Äì$4"
        };
        return {
          name,
          usesThisWeek: approxUses,
          budgetRange: meta.budgetRange,
          storeHint: meta.storeHint
        };
      });

    const plan = {
      mode,
      totalBudget,
      numDays,
      days,
      summary: {
        estimatedFoodCost
      },
      grocerySummary
    };

    lastGeneratedPlan = plan;
    renderPlan(plan);
  }

  // -----------------------------
  // RENDERING
  // -----------------------------
  function renderPlan(plan) {
    const outputSection = document.getElementById("output-section");
    const summaryEl = document.getElementById("plan-summary");
    const daysEl = document.getElementById("days-container");
    const groceryEl = document.getElementById("grocery-container");
    const downloadBtn = document.getElementById("download-pdf-btn");

    outputSection.style.display = "flex";
    daysEl.innerHTML = "";
    groceryEl.innerHTML = "";
    summaryEl.innerHTML = "";

    // Summary
    const underOver = roundToTenths(plan.totalBudget - plan.summary.estimatedFoodCost);
    const statusText =
      underOver >= 0
        ? `~$${underOver} under budget (buffer for tax / price swings).`
        : `~$${Math.abs(underOver)} over budget. Consider rerunning with a slightly higher budget or cheaper focus.`;

    const bubble = document.createElement("div");
    bubble.className = "summary-bubble";
    bubble.textContent = `Total budget: $${plan.totalBudget} ‚Ä¢ Estimated food cost: $${plan.summary.estimatedFoodCost}`;

    const main = document.createElement("div");
    main.className = "summary-main";
    main.appendChild(bubble);

    const line = document.createElement("div");
    line.className = "summary-line";
    line.textContent = statusText;
    main.appendChild(line);

    const modeLine = document.createElement("div");
    modeLine.className = "summary-line";
    modeLine.textContent =
      plan.mode === "busy"
        ? "Focus: Busy Worker ‚Äî prioritizing quick-prep or ready-to-eat meals."
        : "Focus: Budget-First ‚Äî leaning harder on cheap pantry staples.";
    main.appendChild(modeLine);

    summaryEl.appendChild(main);

    // Days
    plan.days.forEach((day, idx) => {
      const card = document.createElement("div");
      card.className = "day-card";

      const header = document.createElement("div");
      header.className = "day-header";

      const title = document.createElement("div");
      title.className = "day-title";
      title.textContent = day.label;

      const cost = document.createElement("div");
      cost.className = "day-cost";
      cost.textContent = `Est. daily cost: $${day.dailyCost}`;

      header.appendChild(title);
      header.appendChild(cost);
      card.appendChild(header);

      const grid = document.createElement("div");
      grid.className = "meals-grid";

      const mealOrder = [
        ["breakfast", "BREAKFAST"],
        ["lunch", "LUNCH"],
        ["dinner", "DINNER"],
        ["snack", "SNACKS"],
        ["beverage", "BEVERAGES"]
      ];

      mealOrder.forEach(([key, label]) => {
        const meal = day.meals[key];
        if (!meal) return;

        const mCard = document.createElement("div");
        mCard.className = "meal-card";

        const titleEl = document.createElement("div");
        titleEl.className = "meal-title";
        titleEl.textContent = label + " ‚Äî " + meal.title;

        const pills = document.createElement("div");
        pills.className = "pill-row";
        pills.appendChild(createTagPills(meal.tags));

        const meta = document.createElement("div");
        meta.className = "pill-meta";
        meta.textContent = `${meal.prepMin} min ¬∑ ~$${meal.costPerServ}/serv`;

        const how = document.createElement("div");
        how.className = "meal-how";
        const ul = document.createElement("ul");
        meal.instructions.forEach(step => {
          const li = document.createElement("li");
          li.textContent = step;
          ul.appendChild(li);
        });
        how.appendChild(ul);

        mCard.appendChild(titleEl);
        mCard.appendChild(pills);
        mCard.appendChild(meta);
        mCard.appendChild(how);
        grid.appendChild(mCard);
      });

      card.appendChild(grid);
      daysEl.appendChild(card);
    });

    // Grocery list
    const headerRow = document.createElement("div");
    headerRow.className = "grocery-header-row";
    const gTitle = document.createElement("h3");
    gTitle.textContent = "Consolidated grocery list";
    const gMeta = document.createElement("div");
    gMeta.className = "grocery-sub";
    gMeta.textContent = `${plan.grocerySummary.length} unique items ¬∑ Est. food cost: $${plan.summary.estimatedFoodCost}`;
    headerRow.appendChild(gTitle);
    headerRow.appendChild(gMeta);
    groceryEl.appendChild(headerRow);

    const list = document.createElement("div");
    list.className = "grocery-items";

    plan.grocerySummary.forEach(item => {
      const row = document.createElement("div");
      row.className = "grocery-row";

      const top = document.createElement("div");
      top.className = "grocery-top";

      const name = document.createElement("div");
      name.className = "grocery-name";
      name.textContent = item.name;

      const uses = document.createElement("div");
      uses.className = "grocery-usage";
      uses.textContent = `~${item.usesThisWeek} uses this week ¬∑ budget: ${item.budgetRange}`;

      top.appendChild(name);
      top.appendChild(uses);

      const meta = document.createElement("div");
      meta.className = "grocery-meta";
      meta.textContent = `Best at: ${item.storeHint}`;

      row.appendChild(top);
      row.appendChild(meta);
      list.appendChild(row);
    });

    groceryEl.appendChild(list);

    const copyRow = document.createElement("div");
    copyRow.className = "copy-row";
    const copyBtn = document.createElement("button");
    copyBtn.className = "btn btn-ghost";
    copyBtn.type = "button";
    copyBtn.innerHTML = '<span class="icon">üìã</span><span>Copy grocery list</span>';
    copyBtn.addEventListener("click", copyGroceryList);
    copyRow.appendChild(copyBtn);
    groceryEl.appendChild(copyRow);

    // Enable PDF button
    downloadBtn.disabled = false;

    // Build and store the grocery text for clipboard & PDF
    buildGroceryListText(plan);
  }

  // -----------------------------
  // GROCERY LIST TEXT + CLIPBOARD
  // -----------------------------
  function buildGroceryListText(plan) {
    const lines = [];
    lines.push("Grocery list from Healthy Meal Engine");
    lines.push("");

    plan.grocerySummary.forEach(item => {
      lines.push(
        `- ${item.name} ‚Äî ~${item.usesThisWeek} uses this week, ` +
        `budget: ${item.budgetRange} ‚Ä¢ ${item.storeHint}`
      );
    });

    lines.push("");
    lines.push(
      `Estimated food cost: $${plan.summary.estimatedFoodCost} (before tax).`
    );

    const text = lines.join("\n");
    lastGroceryText = text;
    return text;
  }

  function copyGroceryList() {
    if (!lastGeneratedPlan) return;

    const text = lastGroceryText && lastGroceryText.trim().length
      ? lastGroceryText
      : buildGroceryListText(lastGeneratedPlan);

    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(text).then(
        () => {
          alert("Grocery list copied to clipboard.");
        },
        () => {
          fallbackCopy(text);
        }
      );
    } else {
      fallbackCopy(text);
    }
  }

  function fallbackCopy(text) {
    const textarea = document.createElement("textarea");
    textarea.value = text;
    textarea.style.position = "fixed";
    textarea.style.opacity = "0";
    document.body.appendChild(textarea);
    textarea.select();
    try {
      document.execCommand("copy");
      alert("Grocery list copied to clipboard.");
    } catch (err) {
      alert("Unable to copy. You can select and copy manually.");
    }
    document.body.removeChild(textarea);
  }

  // -----------------------------
  // PDF DOWNLOAD
  // -----------------------------
  function downloadPdf() {
    if (!lastGeneratedPlan) {
      alert("Generate a plan first.");
      return;
    }
    if (!window.jspdf || !window.jspdf.jsPDF) {
      alert("PDF library not loaded.");
      return;
    }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: "pt", format: "letter" });

    const marginX = 48;
    const maxWidth = 612 - marginX * 2;
    let y = 56;

    const plan = lastGeneratedPlan;
    const groceryText =
      lastGroceryText && lastGroceryText.trim().length
        ? lastGroceryText
        : buildGroceryListText(plan);

    doc.setFont("helvetica", "bold");
    doc.setFontSize(18);
    doc.text("Healthy Meal Engine ‚Äî Weekly Plan", marginX, y);
    y += 24;

    doc.setFont("helvetica", "normal");
    doc.setFontSize(11);
    const summaryLine = `Total budget: $${plan.totalBudget} ‚Ä¢ Estimated food cost: $${plan.summary.estimatedFoodCost}`;
    doc.text(summaryLine, marginX, y);
    y += 18;

    const modeLine =
      plan.mode === "busy"
        ? "Focus: Busy Worker ‚Äî prioritizing quick-prep or ready-to-eat meals."
        : "Focus: Budget-First ‚Äî leaning harder on cheap pantry staples.";
    const wrappedMode = doc.splitTextToSize(modeLine, maxWidth);
    wrappedMode.forEach(line => {
      doc.text(line, marginX, y);
      y += 14;
    });

    y += 10;
    doc.setFont("helvetica", "bold");
    doc.text("Consolidated grocery list", marginX, y);
    y += 16;

    doc.setFont("helvetica", "normal");
    const lines = doc.splitTextToSize(groceryText, maxWidth);
    lines.forEach(line => {
      if (y > 760) {
        doc.addPage();
        y = 40;
      }
      doc.text(line, marginX, y);
      y += 14;
    });

    doc.save("Healthy-Meal-Plan.pdf");
  }

  // -----------------------------
  // EVENT BINDINGS
  // -----------------------------
  document.getElementById("generate-btn").addEventListener("click", generatePlan);
  document.getElementById("download-pdf-btn").addEventListener("click", downloadPdf);

  // Focus toggle
  document.querySelectorAll("#focus-toggle button").forEach(btn => {
    btn.addEventListener("click", () => {
      document
        .querySelectorAll("#focus-toggle button")
        .forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    });
  });
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Healthy Meal Engine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Turn your grocery budget into a simple, healthy, realistic weekly meal plan." />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    :root {
      --bg-light: #f3fbf4;
      --card-bg: #ffffff;
      --accent: #28c76f;
      --accent-soft: #dcf7e7;
      --accent-strong: #14a357;
      --accent-yellow: #fadb5f;
      --accent-red: #ff6b6b;
      --accent-blue: #3a86ff;
      --text-main: #192b33;
      --text-soft: #4b5b65;
      --border-subtle: #e2ebe6;
      --pill-bg: #f5f8fb;
      --shadow-soft: 0 16px 40px rgba(16, 24, 40, 0.08);
      --radius-xl: 28px;
      --radius-lg: 20px;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top left, #e1ffe9 0, #f7fbff 40%, #fdfdfd 100%);
      color: var(--text-main);
    }

    .page {
      max-width: 1120px;
      margin: 0 auto;
      padding: 20px 16px 56px;
    }

    @media (min-width: 768px) {
      .page {
        padding: 32px 16px 72px;
      }
    }

    .hero-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.5fr);
      gap: 20px;
    }

    @media (min-width: 880px) {
      .hero-grid {
        grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.1fr);
        align-items: stretch;
      }
    }

    .hero-card {
      background: linear-gradient(145deg, #ffffff 0, #f3fbf4 40%, #fefcf6 100%);
      border-radius: var(--radius-xl);
      padding: 20px 18px 18px;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    @media (min-width: 768px) {
      .hero-card {
        padding: 24px 22px 22px;
      }
    }

    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: var(--radius-pill);
      background: rgba(40, 199, 111, 0.12);
      color: var(--accent-strong);
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      margin-bottom: 10px;
    }

    .hero-icon-pill {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: radial-gradient(circle at 30% 20%, #8ef0b9 0, #28c76f 40%, #0c8441 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ffffff;
      font-weight: 700;
      font-size: 20px;
      box-shadow: 0 12px 30px rgba(9, 119, 59, 0.35);
      margin-right: 12px;
    }

    .hero-header-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    .hero-title-block h1 {
      margin: 0;
      font-size: 24px;
      line-height: 1.15;
    }

    @media (min-width: 768px) {
      .hero-title-block h1 {
        font-size: 28px;
      }
    }

    .hero-title-block p {
      margin: 4px 0 0;
      font-size: 13px;
      color: var(--text-soft);
    }

    .hero-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 14px 0 16px;
    }

    .audience-pill {
      display: inline-flex;
      flex-direction: column;
      gap: 2px;
      padding: 7px 10px;
      border-radius: 999px;
      background: #ffffff;
      border: 1px solid #d7e5dd;
      box-shadow: 0 2px 4px rgba(15, 23, 42, 0.08);
      font-size: 11px;
    }

    .audience-pill strong {
      font-size: 12px;
    }

    .audience-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      margin-right: 4px;
    }

    .audience-primary .audience-dot {
      background: #2ecc71;
    }

    .audience-secondary .audience-dot {
      background: #3a86ff;
    }

    .hero-copy {
      font-size: 13px;
      color: var(--text-soft);
      margin: 0 0 12px;
    }

    .hero-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 11px;
      margin-bottom: 4px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 5px 9px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.85);
      border: 1px solid rgba(210, 225, 218, 0.9);
    }

    .chip-emoji {
      font-size: 14px;
    }

    .hero-footnote {
      font-size: 11px;
      color: var(--text-soft);
    }

    .hero-footnote strong {
      color: var(--text-main);
    }

    .hero-images {
      display: none;
    }

    @media (min-width: 880px) {
      .hero-images {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .hero-img-row-main {
        display: grid;
        grid-template-columns: 2fr 1.4fr;
        gap: 8px;
      }

      .hero-img-row-sub {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
      }

      .hero-img-card {
        border-radius: 20px;
        overflow: hidden;
        position: relative;
        isolation: isolate;
        background-size: cover;
        background-position: center;
      }

      .hero-img-card::after {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(to top, rgba(0, 0, 0, 0.3), transparent 60%);
        opacity: 0.7;
      }

      .hero-img-card-label {
        position: absolute;
        left: 10px;
        bottom: 10px;
        z-index: 2;
        color: white;
        font-size: 11px;
        font-weight: 500;
        text-shadow: 0 1px 4px rgba(0, 0, 0, 0.6);
        padding: 3px 8px;
        border-radius: 999px;
        background: rgba(0, 0, 0, 0.45);
      }

      .img-healthy-bowl {
        background-image: url("https://images.pexels.com/photos/1437267/pexels-photo-1437267.jpeg?auto=compress&cs=tinysrgb&w=800");
      }

      .img-couple-cooking {
        background-image: url("https://images.pexels.com/photos/1640777/pexels-photo-1640777.jpeg?auto=compress&cs=tinysrgb&w=800");
      }

      .img-burgers {
        background-image: url("https://images.pexels.com/photos/1639557/pexels-photo-1639557.jpeg?auto=compress&cs=tinysrgb&w=800");
      }

      .img-lunchbox {
        background-image: url("https://images.pexels.com/photos/998074/pexels-photo-998074.jpeg?auto=compress&cs=tinysrgb&w=800");
      }
    }

    /* Planner card */

    .planner-card {
      margin-top: 20px;
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      padding: 18px 16px 20px;
      box-shadow: var(--shadow-soft);
    }

    @media (min-width: 768px) {
      .planner-card {
        padding: 22px 22px 24px;
      }
    }

    .planner-header {
      margin-bottom: 12px;
    }

    .planner-header h2 {
      margin: 0;
      font-size: 18px;
    }

    .planner-header p {
      margin: 4px 0 0;
      font-size: 13px;
      color: var(--text-soft);
    }

    .step-label {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--accent-strong);
      margin-bottom: 4px;
    }

    .field-grid {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 10px;
    }

    @media (max-width: 640px) {
      .field-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    label.field-label {
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 4px;
      display: inline-block;
    }

    .hint {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 6px;
    }

    input[type="number"],
    input[type="text"],
    textarea,
    select {
      width: 100%;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      padding: 9px 12px;
      font-size: 13px;
      outline: none;
      background: #f9fbfa;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    textarea {
      border-radius: 14px;
      min-height: 64px;
      resize: vertical;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--accent-strong);
      box-shadow: 0 0 0 1px rgba(40, 199, 111, 0.3);
      background: #ffffff;
    }

    .pill-toggle {
      display: inline-flex;
      align-items: center;
      border-radius: 999px;
      padding: 3px;
      background: #f1f5f4;
      border: 1px solid #d7e5dd;
      margin: 6px 0 8px;
    }

    .pill-toggle button {
      border: none;
      background: transparent;
      padding: 6px 13px;
      border-radius: 999px;
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--text-soft);
    }

    .pill-toggle button.active {
      background: #22c55e;
      color: #ffffff;
      box-shadow: 0 6px 14px rgba(34, 197, 94, 0.4);
    }

    .pill-toggle button span.dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.1);
    }

    .pill-toggle button.active span.dot {
      background: rgba(255, 255, 255, 0.9);
    }

    .quick-budget-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
      margin-bottom: 4px;
    }

    .quick-budget-pill {
      font-size: 11px;
      padding: 5px 8px;
      border-radius: 999px;
      border: 1px dashed #d7e5dd;
      background: #f7fbf9;
      cursor: pointer;
      color: var(--text-soft);
    }

    .action-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
      align-items: center;
    }

    .btn-primary {
      border-radius: 999px;
      border: none;
      padding: 10px 18px;
      font-size: 14px;
      font-weight: 600;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #ffffff;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      box-shadow: 0 10px 24px rgba(34, 197, 94, 0.45);
    }

    .btn-primary span.sparkle {
      font-size: 16px;
    }

    .btn-secondary {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      padding: 9px 14px;
      font-size: 12px;
      font-weight: 500;
      background: #ffffff;
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .small-note {
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 4px;
    }

    /* Plan + grocery */

    .plan-wrapper {
      margin-top: 20px;
    }

    .plan-summary-pill {
      border-radius: 999px;
      background: #e0fbe9;
      padding: 9px 14px;
      display: inline-flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      font-size: 12px;
      margin-bottom: 10px;
    }

    .plan-summary-pill strong {
      font-weight: 600;
    }

    .plan-summary-pill span.buffer {
      border-radius: 999px;
      padding: 3px 8px;
      background: rgba(21, 128, 61, 0.08);
      border: 1px solid rgba(21, 128, 61, 0.24);
      font-size: 11px;
    }

    .plan-note {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 10px;
    }

    .day-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 12px;
    }

    @media (min-width: 880px) {
      .day-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .day-card {
      border-radius: 20px;
      border: 1px solid var(--border-subtle);
      background: #ffffff;
      padding: 12px 12px 14px;
    }

    .day-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
    }

    .day-header h3 {
      margin: 0;
      font-size: 14px;
    }

    .day-header span.cost {
      font-size: 11px;
      color: var(--text-soft);
    }

    .meal-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 8px;
    }

    @media (min-width: 520px) {
      .meal-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .meal-card {
      border-radius: 16px;
      background: #f8fbf9;
      border: 1px dashed #d9e6df;
      padding: 8px 9px 9px;
      font-size: 12px;
    }

    .meal-type {
      font-size: 11px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      font-weight: 600;
      color: var(--text-soft);
      margin-bottom: 2px;
    }

    .meal-name {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-bottom: 4px;
    }

    .tag-pill {
      font-size: 10px;
      padding: 3px 7px;
      border-radius: 999px;
      color: #0f172a;
    }

    .tag-busy {
      background: rgba(58, 134, 255, 0.16);
      color: #1d4ed8;
    }

    .tag-budget {
      background: rgba(34, 197, 94, 0.14);
      color: #15803d;
    }

    .tag-protein {
      background: rgba(249, 115, 22, 0.14);
      color: #c05621;
    }

    .tag-quick {
      background: rgba(248, 113, 113, 0.16);
      color: #b91c1c;
    }

    .meal-meta {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 4px;
    }

    .how-to-title {
      font-size: 11px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .how-to-list {
      margin: 0;
      padding-left: 18px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .how-to-list li + li {
      margin-top: 2px;
    }

    .section-heading {
      margin: 16px 0 6px;
      font-size: 14px;
    }

    .grocery-card {
      border-radius: 20px;
      border: 1px solid var(--border-subtle);
      background: #ffffff;
      padding: 10px 12px 12px;
      margin-top: 6px;
    }

    .grocery-header-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
    }

    .grocery-header-row h3 {
      margin: 0;
      font-size: 14px;
    }

    .grocery-header-row span.meta {
      font-size: 11px;
      color: var(--text-soft);
    }

    .grocery-list {
      list-style: none;
      margin: 6px 0 0;
      padding: 0;
      font-size: 12px;
    }

    .grocery-item {
      padding: 7px 0;
      border-bottom: 1px dashed #e2ebe6;
    }

    .grocery-item:last-child {
      border-bottom: none;
    }

    .grocery-name-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      font-weight: 500;
    }

    .grocery-uses {
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 2px;
    }

    .grocery-best {
      font-size: 11px;
      color: #15803d;
      margin-top: 2px;
    }

    .grocery-best span.label {
      font-weight: 500;
    }

    .grocery-footer-note {
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 6px;
    }

    .bottom-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
      align-items: center;
    }

    .version-tag {
      font-size: 10px;
      color: var(--text-soft);
    }

    .toast {
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: #111827;
      color: #f9fafb;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 12px;
      display: none;
      align-items: center;
      gap: 6px;
      z-index: 999;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.4);
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="hero-grid">
      <section class="hero-card">
        <div class="hero-badge">
          <span>Healthy Meal Engine ¬∑ Beta</span>
        </div>

        <div class="hero-header-row">
          <div class="hero-icon-pill">H</div>
          <div class="hero-title-block">
            <h1>Healthy Meal Engine</h1>
            <p>Turn your grocery budget into a simple, healthy, realistic plan.</p>
          </div>
        </div>

        <div class="hero-pills">
          <div class="audience-pill audience-primary">
            <div><span class="audience-dot"></span><strong>Primary: Busy Worker</strong></div>
            <div>Max results ‚Ä¢ minimal cooking ‚Ä¢ still healthy</div>
          </div>
          <div class="audience-pill audience-secondary">
            <div><span class="audience-dot"></span><strong>Secondary: Budget-First</strong></div>
            <div>Stretch every dollar without eating trash</div>
          </div>
        </div>

        <p class="hero-copy">
          No calorie math, no perfection. Just practical meals and a grocery list that match your time, money,
          and energy level.
        </p>

        <div class="hero-chips">
          <div class="chip"><span class="chip-emoji">ü•ó</span> 3 meals + snacks covered</div>
          <div class="chip"><span class="chip-emoji">üßæ</span> Consolidated grocery list</div>
          <div class="chip"><span class="chip-emoji">‚è±</span> Busy-friendly prep times</div>
        </div>

        <p class="hero-footnote">
          <strong>Built for real life, not Pinterest.</strong> Quick wins for solo people & busy workers who want to
          eat decently on a real-person budget.
        </p>
      </section>

      <aside class="hero-images">
        <div class="hero-img-row-main">
          <div class="hero-img-card img-healthy-bowl">
            <div class="hero-img-card-label">Healthy-ish meal on a budget</div>
          </div>
          <div class="hero-img-card img-lunchbox">
            <div class="hero-img-card-label">Prep once, eat twice</div>
          </div>
        </div>
        <div class="hero-img-row-sub">
          <div class="hero-img-card img-couple-cooking">
            <div class="hero-img-card-label">Quick home cooking</div>
          </div>
          <div class="hero-img-card img-burgers">
            <div class="hero-img-card-label">Room for fun food too</div>
          </div>
        </div>
      </aside>
    </div>

    <!-- Planner card -->
    <section class="planner-card">
      <header class="planner-header">
        <h2>Build Your Week</h2>
        <p>Tell the engine how you actually live. We‚Äôll return meals & a grocery list that match your budget and energy.</p>
      </header>

      <div class="step-label">Step 1 ¬∑ Who are we feeding & for how long?</div>
      <div class="field-grid">
        <div>
          <label class="field-label" for="totalBudget">Total food budget ($)</label>
          <input id="totalBudget" type="number" min="10" step="1" placeholder="e.g. 60" />
          <div class="quick-budget-row">
            <button class="quick-budget-pill" data-budget="40">Solo ¬∑ 4‚Äì5 days ¬∑ ~$40</button>
            <button class="quick-budget-pill" data-budget="60">Solo ¬∑ 5‚Äì7 days ¬∑ ~$60</button>
            <button class="quick-budget-pill" data-budget="100">2 people ¬∑ 7 days ¬∑ ~$100</button>
          </div>
        </div>
        <div>
          <label class="field-label" for="durationDays">Rough duration (days)</label>
          <input id="durationDays" type="number" min="3" max="10" step="1" placeholder="e.g. 5" />
          <div class="hint">We‚Äôll still show 5 days; this just helps the math feel right.</div>
        </div>
      </div>

      <div class="step-label" style="margin-top: 12px;">Step 2 ¬∑ Focus mode</div>
      <label class="field-label">What matters most this week?</label>
      <div class="pill-toggle" id="focusToggle">
        <button type="button" data-mode="busy" class="active">
          <span class="dot"></span>Busy Worker
        </button>
        <button type="button" data-mode="budget">
          <span class="dot"></span>Budget-First
        </button>
      </div>
      <div class="hint" id="focusHint">
        Busy Worker: prioritizes quick-prep or ready-to-eat meals that still hit the health bar.
      </div>

      <div class="step-label" style="margin-top: 12px;">Step 3 ¬∑ Food fit check</div>
      <div class="field-grid">
        <div>
          <label class="field-label" for="eatingStyle">Eating style</label>
          <select id="eatingStyle">
            <option value="omnivore">Omnivore (no major restrictions)</option>
            <option value="noPork">No pork</option>
            <option value="noShellfish">No shellfish</option>
            <option value="vegetarian">Vegetarian with eggs & dairy</option>
            <option value="pescatarian">Pescatarian</option>
          </select>
        </div>
        <div>
          <label class="field-label" for="hardNoIngredients">Hard no ingredients</label>
          <input
            id="hardNoIngredients"
            type="text"
            placeholder='Comma-separated. e.g. "peanut butter, tuna, mushrooms"'
          />
        </div>
      </div>

      <div style="margin-top: 12px;">
        <div class="step-label">Step 4 ¬∑ Lifestyle constraints (optional)</div>
        <label class="field-label" for="constraints">Anything we should know?</label>
        <textarea
          id="constraints"
          placeholder='Short notes like "no oven", "office microwave only", "gym 3x nights".'
        ></textarea>
      </div>

      <div class="action-row">
        <button class="btn-primary" type="button" id="generateBtn">
          <span class="sparkle">‚ú®</span> Generate meal plan
        </button>
        <button class="btn-secondary" type="button" id="downloadPdfBtn">
          üìÑ Download PDF
        </button>
        <button class="btn-secondary" type="button" id="copyGroceryBtn">
          üìã Copy grocery list
        </button>
      </div>
      <div class="small-note">
        Heads up: Prices are rough estimates based on discount-grocer style pricing. Your store may vary.
      </div>
    </section>

    <!-- Plan + grocery -->
    <section class="plan-wrapper" id="planSection" style="display:none;">
      <div class="section-heading">Your Weekly Plan</div>
      <div class="plan-summary-pill" id="planSummaryPill">
        <!-- filled by JS -->
      </div>
      <div class="plan-note">
        Daily meals first, then a consolidated grocery list. Built for real life, not Pinterest perfection.
      </div>

      <div id="weekly-plan">
        <div class="day-grid" id="dayGrid"></div>

        <h3 class="section-heading">Consolidated grocery list</h3>
        <div class="grocery-card">
          <div class="grocery-header-row">
            <h3>Shopping list for the week</h3>
            <span class="meta" id="groceryMeta"></span>
          </div>
          <ul class="grocery-list" id="groceryList"></ul>
          <div class="grocery-footer-note">
            Healthy Meal Engine ¬∑ v1.4 ‚Äì Cooking steps + store hints edition. Prices are rough estimates based on
            discount-grocer style pricing. Your store may vary.
          </div>
        </div>
      </div>

      <div class="bottom-actions">
        <span class="version-tag">Healthy Meal Engine ¬∑ v1.4 ‚Äì Cooking steps + store hints edition</span>
      </div>
    </section>
  </div>

  <div class="toast" id="toast">
    <span id="toastText"></span>
  </div>

  <!-- PDF library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    // -------- Static data --------

    const ESTIMATED_FOOD_COST = 67.5;
    const groceryItems = [
      { name: "Milk or water", uses: "~0.3 uses this week", budget: "$2‚Äì$4", bestAt: "Any grocery / big-box" },
      { name: "Water", uses: "~0.5 uses this week", budget: "$2‚Äì$4", bestAt: "Any grocery store / big-box" },
      { name: "Flavor drops", uses: "~0.2 uses this week", budget: "$3‚Äì$5", bestAt: "Any grocery store / big-box" },
      { name: "Whole grain bread", uses: "~0.5 uses this week", budget: "$2‚Äì$4", bestAt: "Bakery or bread aisle (any grocery)" },
      { name: "Tortillas", uses: "~1 uses this week", budget: "$2‚Äì$4", bestAt: "Bread/tortilla aisle (any grocery)" },
      { name: "Chia seeds", uses: "~0.4 uses this week", budget: "~$5", bestAt: "Bulk aisle or online (Amazon)" },
      { name: "Canned tuna", uses: "~0.7 uses this week", budget: "$3‚Äì$5", bestAt: "Canned goods aisle (any grocery)" },
      { name: "Granola", uses: "~0.6 uses this week", budget: "~$5", bestAt: "Cereal aisle (big-box or grocery)" },
      { name: "Feta", uses: "~0.4 uses this week", budget: "$3‚Äì$5", bestAt: "Cheese section (any grocery)" },
      { name: "Oat or almond milk", uses: "~0.8 uses this week", budget: "$3‚Äì$5", bestAt: "Dairy alternative section (any grocery)" },
      { name: "Chicken thighs", uses: "~1.2 uses this week", budget: "~$8", bestAt: "Discount grocer (Aldi/Lidl/Walmart)" },
      { name: "Rolled oats", uses: "~0.8 uses this week", budget: "$2‚Äì$4", bestAt: "Discount grocer or bulk aisle" },
      { name: "Frozen salmon", uses: "~1 uses this week", budget: "~$10", bestAt: "Freezer / seafood section" },
      { name: "Frozen grain veggie bowl", uses: "~1 uses this week", budget: "~$5", bestAt: "Freezer aisle (big-box / grocery)" },
      { name: "Frozen berries", uses: "~0.9 uses this week", budget: "$3‚Äì$5", bestAt: "Freezer aisle (discount grocer or big-box)" },
      { name: "Frozen green beans", uses: "~0.8 uses this week", budget: "$2‚Äì$4", bestAt: "Frozen or produce section" },
      { name: "Rotisserie chicken", uses: "~0.8 uses this week", budget: "~$8", bestAt: "Grocery deli / hot foods" },
      { name: "Olive oil", uses: "~0.7 uses this week", budget: "~$6", bestAt: "Oils aisle (any grocery store / big-box)" },
      { name: "Protein powder", uses: "~0.3 uses this week", budget: "~$18", bestAt: "Online/big-box (Amazon, Walmart, Target)" },
      { name: "Peanut butter", uses: "~0.3 uses this week", budget: "$2‚Äì$4", bestAt: "Peanut butter/jam aisle" },
      { name: "Pickles or celery", uses: "~0.2 uses this week", budget: "$2‚Äì$4", bestAt: "Pickle aisle or produce" },
      { name: "Bananas", uses: "~1 uses this week", budget: "$2‚Äì$4", bestAt: "Produce section (any grocery)" },
      { name: "Cucumber", uses: "~0.6 uses this week", budget: "$1‚Äì$2", bestAt: "Produce section (any grocery)" },
      { name: "Carrots", uses: "~1.6 uses this week", budget: "$2‚Äì$4", bestAt: "Produce section (any grocery)" },
      { name: "Baby potatoes", uses: "~1 uses this week", budget: "$2‚Äì$4", bestAt: "Produce section (any grocery)" },
      { name: "Apples", uses: "~0.4 uses this week", budget: "$2‚Äì$4", bestAt: "Produce section (any grocery)" },
      { name: "Lemons", uses: "~0.4 uses this week", budget: "$2‚Äì$4", bestAt: "Produce section (any grocery)" },
      { name: "Baby carrots", uses: "~0.5 uses this week", budget: "$1‚Äì$2", bestAt: "Produce section (any grocery)" },
      { name: "Spinach", uses: "~0.3 uses this week", budget: "$1‚Äì$2", bestAt: "Produce section (any grocery)" },
      { name: "Greek yogurt", uses: "~0.8 uses this week", budget: "~$5", bestAt: "Refrigerated dairy (any grocery)" },
      { name: "Hummus", uses: "~1 uses this week", budget: "$3‚Äì$5", bestAt: "Refrigerated dips (any grocery)" },
      { name: "Rice", uses: "~0.8 uses this week", budget: "$3‚Äì$5", bestAt: "Rice/grains aisle (any grocery)" },
      { name: "Protein bars", uses: "~0.5 uses this week", budget: "~$7", bestAt: "Snacks or nutrition aisle (big-box/grocery)" },
      { name: "Seasoning blend", uses: "~0.2 uses this week", budget: "$2‚Äì$4", bestAt: "Spice aisle (any grocery)" },
      { name: "Green tea bags", uses: "~0.3 uses this week", budget: "$2‚Äì$4", bestAt: "Tea/coffee aisle" }
    ];

    const days = [
      {
        name: "Day 1",
        cost: 9.4,
        meals: [
          {
            type: "Breakfast",
            name: "Overnight oats with chia & banana",
            tags: ["busy", "budget", "quick"],
            meta: "5 min ‚Ä¢ ~$1.5/serv",
            steps: [
              "Add oats, chia seeds, and cinnamon to a jar or container.",
              "Pour in enough milk to fully cover oats and stir.",
              "Refrigerate overnight; add sliced banana in the morning."
            ]
          },
          {
            type: "Lunch",
            name: "Hummus, veggie & feta wrap",
            tags: ["busy", "quick"],
            meta: "7 min ‚Ä¢ ~$2.5/serv",
            steps: [
              "Spread hummus over a tortilla.",
              "Add sliced cucumber, shredded carrots, and a sprinkle of feta.",
              "Roll up tightly and slice in half if desired."
            ]
          },
          {
            type: "Dinner",
            name: "Baked salmon, rice & green beans",
            tags: ["protein"],
            meta: "12 min ‚Ä¢ ~$4.2/serv (with precooked rice)",
            steps: [
              "Preheat oven to ~400¬∞F (200¬∞C). Place salmon on a lined tray.",
              "Drizzle with olive oil, salt, pepper, and lemon.",
              "Bake 12‚Äì18 minutes depending on thickness. Heat rice & green beans and serve together."
            ]
          },
          {
            type: "Snacks",
            name: "Carrots & hummus",
            tags: ["busy", "budget", "quick"],
            meta: "2 min ‚Ä¢ ~$0.9/serv",
            steps: [
              "Portion baby carrots onto a plate or container.",
              "Serve with a scoop of hummus for dipping."
            ]
          },
          {
            type: "Beverages",
            name: "Green tea",
            tags: ["budget", "quick"],
            meta: "3 min ‚Ä¢ ~$0.4/serv",
            steps: [
              "Boil water and let it sit 1‚Äì2 minutes to cool slightly.",
              "Steep tea bag 2‚Äì3 minutes.",
              "Remove bag to avoid bitterness."
            ]
          }
        ]
      },
      {
        name: "Day 2",
        cost: 8.5,
        meals: [
          {
            type: "Breakfast",
            name: "Greek yogurt + berries + granola",
            tags: ["busy", "budget", "protein", "quick"],
            meta: "3 min ‚Ä¢ ~$2.4/serv",
            steps: [
              "Scoop Greek yogurt into a bowl.",
              "Top with a handful of frozen berries.",
              "Sprinkle granola on top right before eating so it stays crunchy."
            ]
          },
          {
            type: "Lunch",
            name: "Tuna salad on whole grain toast",
            tags: ["budget", "protein"],
            meta: "8 min ‚Ä¢ ~$2/serv",
            steps: [
              "Drain canned tuna and add to a bowl.",
              "Mix with Greek yogurt or light mayo and chopped pickles/celery.",
              "Toast bread and spread tuna salad on top."
            ]
          },
          {
            type: "Dinner",
            name: "Sheet pan chicken, potatoes & carrots",
            tags: ["budget", "protein"],
            meta: "15 min prep ‚Ä¢ ~$3/serv",
            steps: [
              "Preheat oven to ~400¬∞F (200¬∞C) and line a sheet pan.",
              "Toss chicken, chopped potatoes, and carrots with olive oil and seasoning.",
              "Spread on the pan and roast 25‚Äì35 minutes until cooked through and browned."
            ]
          },
          {
            type: "Snacks",
            name: "Apple + peanut butter",
            tags: ["budget", "quick"],
            meta: "2 min ‚Ä¢ ~$1/serv",
            steps: [
              "Slice an apple just before eating.",
              "Serve with a spoonful or two of peanut butter for dipping."
            ]
          },
          {
            type: "Beverages",
            name: "Water + flavor drops or lemon",
            tags: ["budget", "quick"],
            meta: "1 min ‚Ä¢ ~$0.1/serv",
            steps: [
              "Fill a bottle or large cup with water.",
              "Squeeze in lemon or add a small amount of flavor drops.",
              "Sip throughout the day."
            ]
          }
        ]
      },
      {
        name: "Day 3",
        cost: 9.7,
        meals: [
          {
            type: "Breakfast",
            name: "Overnight oats with chia & banana",
            tags: ["busy", "budget", "quick"],
            meta: "5 min ‚Ä¢ ~$1.5/serv",
            steps: [
              "Repeat Day 1 overnight oat prep, or finish leftovers.",
              "Top with banana in the morning."
            ]
          },
          {
            type: "Lunch",
            name: "Microwave-friendly frozen veggie + protein bowl",
            tags: ["busy", "quick"],
            meta: "8 min ‚Ä¢ ~$3/serv",
            steps: [
              "Microwave frozen grain & veggie bowl per package directions.",
              "Shred rotisserie chicken and stir into the bowl for extra protein.",
              "Season to taste (salt, pepper, hot sauce)."
            ]
          },
          {
            type: "Dinner",
            name: "Sheet pan chicken, potatoes & carrots (leftovers)",
            tags: ["budget", "protein"],
            meta: "5 min ‚Ä¢ leftovers",
            steps: [
              "Reheat leftover chicken, potatoes, and carrots in oven, air fryer, or microwave.",
              "Add extra seasoning or hot sauce if needed."
            ]
          },
          {
            type: "Snacks",
            name: "Low-sugar protein bar",
            tags: ["busy", "protein", "quick"],
            meta: "1 min ‚Ä¢ ~$1.5/serv",
            steps: [
              "Keep a bar in your bag, desk, or car.",
              "Grab one when you need quick protein on the go."
            ]
          },
          {
            type: "Beverages",
            name: "Green tea or water + flavor",
            tags: ["budget", "quick"],
            meta: "3 min ‚Ä¢ ~$0.3/serv",
            steps: [
              "Alternate green tea and flavored water depending on mood.",
              "Keep a refillable bottle nearby."
            ]
          }
        ]
      },
      {
        name: "Day 4",
        cost: 10.0,
        meals: [
          {
            type: "Breakfast",
            name: "Greek yogurt + berries + granola (repeat)",
            tags: ["busy", "budget", "protein", "quick"],
            meta: "3 min ‚Ä¢ ~$2.4/serv",
            steps: [
              "Scoop Greek yogurt into a bowl.",
              "Top with frozen berries and granola."
            ]
          },
          {
            type: "Lunch",
            name: "Tuna salad wrap",
            tags: ["budget", "protein"],
            meta: "8 min ‚Ä¢ ~$2.2/serv",
            steps: [
              "Mix canned tuna with Greek yogurt or light mayo and chopped celery/pickles.",
              "Spread onto a tortilla and roll tightly.",
              "Slice into halves or pinwheels."
            ]
          },
          {
            type: "Dinner",
            name: "Baked salmon, rice & green beans (repeat)",
            tags: ["protein"],
            meta: "12 min ‚Ä¢ ~$4.2/serv",
            steps: [
              "Bake salmon as on Day 1 or reheat leftovers.",
              "Serve with rice and green beans."
            ]
          },
          {
            type: "Snacks",
            name: "Carrots & hummus or apple + peanut butter",
            tags: ["budget", "quick"],
            meta: "2‚Äì3 min ‚Ä¢ ~$1/serv",
            steps: [
              "Pick whichever snack you‚Äôre craving that day.",
              "Portion ahead into small containers if helpful."
            ]
          },
          {
            type: "Beverages",
            name: "Green tea",
            tags: ["budget", "quick"],
            meta: "3 min ‚Ä¢ ~$0.4/serv",
            steps: [
              "Steep tea bag 2‚Äì3 minutes.",
              "Drink hot or over ice."
            ]
          }
        ]
      },
      {
        name: "Day 5",
        cost: 9.6,
        meals: [
          {
            type: "Breakfast",
            name: "Protein smoothie (frozen fruit + protein powder)",
            tags: ["busy", "protein", "quick"],
            meta: "4 min ‚Ä¢ ~$2.2/serv",
            steps: [
              "Add frozen fruit, protein powder, and milk/water to a blender.",
              "Blend until smooth; adjust liquid for desired thickness."
            ]
          },
          {
            type: "Lunch",
            name: "Hummus, veggie & feta wrap (repeat)",
            tags: ["busy", "quick"],
            meta: "7 min ‚Ä¢ ~$2.5/serv",
            steps: [
              "Repeat wrap from earlier in the week or use leftover veggies."
            ]
          },
          {
            type: "Dinner",
            name: "Sheet pan chicken, potatoes & carrots (final round)",
            tags: ["budget", "protein"],
            meta: "15 min ‚Ä¢ ~$3/serv",
            steps: [
              "Cook a fresh tray or finish any leftovers.",
              "Serve with extra veggies if available."
            ]
          },
          {
            type: "Snacks",
            name: "Low-sugar protein bar or fruit",
            tags: ["busy", "protein", "quick"],
            meta: "1‚Äì2 min ‚Ä¢ ~$1/serv",
            steps: [
              "Rotate between bars and simple fruit like bananas or apples."
            ]
          },
          {
            type: "Beverages",
            name: "Green tea or water + flavor",
            tags: ["budget", "quick"],
            meta: "3 min ‚Ä¢ ~$0.3/serv",
            steps: [
              "Refill bottle; keep sipping throughout the day."
            ]
          }
        ]
      }
    ];

    // -------- Helpers --------

    const $ = (sel) => document.querySelector(sel);

    function showToast(message) {
      const toast = $("#toast");
      const text = $("#toastText");
      text.textContent = message;
      toast.style.display = "flex";
      setTimeout(() => {
        toast.style.display = "none";
      }, 1900);
    }

    function getFocusMode() {
      const activeBtn = document.querySelector("#focusToggle button.active");
      return activeBtn?.dataset.mode || "busy";
    }

    // -------- Render functions --------

    function renderPlan() {
      const planSection = $("#planSection");
      planSection.style.display = "block";

      const totalBudgetInput = $("#totalBudget");
      const durationInput = $("#durationDays");
      const focusMode = getFocusMode();

      const budget = Number(totalBudgetInput.value) || 60;
      const duration = Number(durationInput.value) || 5;

      const buffer = budget - ESTIMATED_FOOD_COST;
      const summary = $("#planSummaryPill");

      let focusText =
        focusMode === "busy"
          ? "Focus: Busy Worker ‚Äî prioritizing quick-prep or ready-to-eat meals."
          : "Focus: Budget-First ‚Äî leaning into cheaper, repeat-friendly meals.";

      const bufferText =
        buffer >= 0
          ? `~$${buffer.toFixed(1)} under budget (buffer for tax / price swings).`
          : `~$${Math.abs(buffer).toFixed(1)} over budget ‚Äî consider trimming snacks or protein portions.`;

      summary.innerHTML = `
        <span><strong>Total budget:</strong> $${budget.toFixed(0)}</span>
        <span><strong>Estimated food cost:</strong> $${ESTIMATED_FOOD_COST.toFixed(1)}</span>
        <span class="buffer">${bufferText}</span>
        <span>${focusText}</span>
        <span>Plan assumes ~${duration} real-life days of eating.</span>
      `;

      const dayGrid = $("#dayGrid");
      dayGrid.innerHTML = "";

      days.forEach((day) => {
        const dayCard = document.createElement("div");
        dayCard.className = "day-card";

        const header = document.createElement("div");
        header.className = "day-header";
        header.innerHTML = `
          <h3>${day.name}</h3>
          <span class="cost">Est. daily cost: $${day.cost.toFixed(1)}</span>
        `;
        dayCard.appendChild(header);

        const mealGrid = document.createElement("div");
        mealGrid.className = "meal-grid";

        day.meals.forEach((meal) => {
          const mealCard = document.createElement("div");
          mealCard.className = "meal-card";

          const tagsHtml = meal.tags
            .map((tag) => {
              let cls = "tag-pill";
              if (tag === "busy") cls += " tag-busy";
              if (tag === "budget") cls += " tag-budget";
              if (tag === "protein") cls += " tag-protein";
              if (tag === "quick") cls += " tag-quick";
              return `<span class="${cls}">${
                tag === "busy"
                  ? "busy-friendly"
                  : tag === "budget"
                  ? "budget pick"
                  : tag === "protein"
                  ? "high protein"
                  : "<10 min prep"
              }</span>`;
            })
            .join("");

          const stepsHtml = meal.steps.map((s) => `<li>${s}</li>`).join("");

          mealCard.innerHTML = `
            <div class="meal-type">${meal.type.toUpperCase()}</div>
            <div class="meal-name">${meal.name}</div>
            <div class="tag-row">${tagsHtml}</div>
            <div class="meal-meta">${meal.meta}</div>
            <div class="how-to-title">How to make:</div>
            <ul class="how-to-list">${stepsHtml}</ul>
          `;

          mealGrid.appendChild(mealCard);
        });

        dayCard.appendChild(mealGrid);
        dayGrid.appendChild(dayCard);
      });

      renderGrocery();
    }

    function renderGrocery() {
      const listEl = $("#groceryList");
      const metaEl = $("#groceryMeta");
      listEl.innerHTML = "";

      groceryItems.forEach((item) => {
        const li = document.createElement("li");
        li.className = "grocery-item";
        li.innerHTML = `
          <div class="grocery-name-row">
            <span>${item.name}</span>
            <span>${item.budget}</span>
          </div>
          <div class="grocery-uses">${item.uses}</div>
          <div class="grocery-best"><span class="label">Best at:</span> ${item.bestAt}</div>
        `;
        listEl.appendChild(li);
      });

      metaEl.textContent = `${groceryItems.length} unique items ¬∑ Est. food cost: $${ESTIMATED_FOOD_COST.toFixed(1)}`;
    }

    function buildGroceryPlainText() {
      const lines = [];
      lines.push("Grocery list from Healthy Meal Engine");
      lines.push("");
      groceryItems.forEach((item) => {
        lines.push(
          `- ${item.name} ‚Äî ${item.uses}, budget: ${item.budget} ‚Ä¢ ${item.bestAt}`
        );
      });
      lines.push("");
      lines.push(`Estimated food cost: $${ESTIMATED_FOOD_COST.toFixed(1)} (before tax).`);
      return lines.join("\n");
    }

    // -------- PDF --------

    async function downloadPDF() {
      try {
        if (!window.jspdf || !window.jspdf.jsPDF) {
          alert("PDF library failed to load. Please refresh and try again.");
          return;
        }
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF("p", "mm", "a4");

        const budget = Number($("#totalBudget").value) || 60;
        const buffer = budget - ESTIMATED_FOOD_COST;
        const bufferText =
          buffer >= 0
            ? `~$${buffer.toFixed(1)} under budget (buffer for tax / price swings).`
            : `~$${Math.abs(buffer).toFixed(1)} over budget ‚Äî consider trimming snacks or portions.`;

        let y = 14;
        doc.setFont("helvetica", "bold");
        doc.setFontSize(14);
        doc.text("Healthy Meal Engine ¬∑ Weekly Grocery Plan", 14, y);

        y += 8;
        doc.setFontSize(11);
        doc.setFont("helvetica", "normal");
        const summaryLines = doc.splitTextToSize(
          `Total budget: $${budget.toFixed(
            0
          )} ‚Ä¢ Estimated food cost: $${ESTIMATED_FOOD_COST.toFixed(1)}. ${bufferText}`,
          180
        );
        doc.text(summaryLines, 14, y);
        y += summaryLines.length * 6 + 4;

        doc.setFont("helvetica", "bold");
        doc.text("Consolidated grocery list", 14, y);
        y += 6;

        doc.setFont("helvetica", "normal");
        const groceryText = buildGroceryPlainText();
        const lines = doc.splitTextToSize(groceryText, 180);

        lines.forEach((line) => {
          if (y > 280) {
            doc.addPage();
            y = 14;
          }
          doc.text(line, 14, y);
          y += 5;
        });

        doc.save("Healthy-Meal-Plan.pdf");
      } catch (err) {
        console.error(err);
        alert("Error generating PDF. Please try again.");
      }
    }

    // -------- Event wiring --------

    document.addEventListener("DOMContentLoaded", () => {
      // Focus toggle
      document.querySelectorAll("#focusToggle button").forEach((btn) => {
        btn.addEventListener("click", () => {
          document.querySelectorAll("#focusToggle button").forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          const mode = btn.dataset.mode;
          const hint = $("#focusHint");
          if (mode === "busy") {
            hint.textContent =
              "Busy Worker: prioritizes quick-prep or ready-to-eat meals that still hit the health bar.";
          } else {
            hint.textContent =
              "Budget-First: leans into cheaper ingredients, repeats, and leftovers to stretch your dollars.";
          }
        });
      });

      // Quick budget pills
      document.querySelectorAll(".quick-budget-pill").forEach((pill) => {
        pill.addEventListener("click", () => {
          $("#totalBudget").value = pill.dataset.budget;
        });
      });

      // Generate button
      $("#generateBtn").addEventListener("click", () => {
        renderPlan();
        window.scrollTo({ top: document.body.scrollHeight / 3, behavior: "smooth" });
      });

      // Copy grocery list
      $("#copyGroceryBtn").addEventListener("click", async () => {
        try {
          const text = buildGroceryPlainText();
          await navigator.clipboard.writeText(text);
          showToast("Grocery list copied to clipboard");
        } catch (err) {
          console.error(err);
          showToast("Could not copy. Long-press and copy manually.");
        }
      });

      // PDF download
      $("#downloadPdfBtn").addEventListener("click", () => {
        downloadPDF();
      });
    });
  </script>
</body>
</html>
